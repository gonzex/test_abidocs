
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Abinit documentation">
      
      
        <link rel="canonical" href="http://www.abinit.org/tutorials/bse/">
      
      
        <meta name="author" content="The Abinit group">
      
      
        <link rel="shortcut icon" href="../../images/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.8.1">
    
    
      
        <title>Bethe-Salpeter - abinit</title>
      
    
    

    
      <script src="../../assets/javascripts/modernizr-1df76c4e58.js"></script>
    

    <!-- Jquery from Google CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Bootstrap http://getbootstrap.com/getting-started/ -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" 
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" 
    integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" 
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous">
    </script>

    <!--Pace support. http://github.hubspot.com/pace/ -->
    <script>
        paceOptions = {
            ajax: true,      // disabled
            document: true,  // activated
            eventLag: false  // disabled
            //target: 'article'
            //elements: {selectors: ['.my-page']}
        };
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/white/pace-theme-big-counter.min.css" />

    <!--
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/white/pace-theme-bounce.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-corner-indicator.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-flat-top.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-loading-bar.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-center-atom.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-flash.min.css" />
    -->

    <!-- MathJax support
    <script type="text/javascript" async 
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script> 
    -->
    <!--
    This is compatible with plotly.
    -->
    <script type="text/javascript" async 
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_SVG">
    </script> 

    <!--
    Configure MathJax to produce automatic equation numbers http://docs.mathjax.org/en/latest/tex.html
    -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          TeX: {
              equationNumbers: { autoNumber: "all" },
              extensions: ["AMSmath.js"],
              Macros: {
                  rr: "{\\bf r}",
                  GG: "{\\bf G}",
                  kk: "{\\bf k}",
                  qq: "{\\bf q}",
                  kq: "{\\kk + \\qq}"
              }
          }
      });
    </script>

    <!-- See http://docs.mathjax.org/en/latest/start.html 
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        extensions: ["tex2jax.js", "MathMenu.js", "MathZoom.js"],
        jax: ["input/TeX", "output/HTML-CSS", "output/NativeMML],
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true
        },
        "HTML-CSS": { availableFonts: ["TeX"] }
      });
    </script>
    -->

    
    
    

    <!-- Load Ubuntu fonts used for input variables -->
    <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">


    
      <link rel="stylesheet" href="../../assets/stylesheets/application-bfecc7305d.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-02c2a4388f.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/gallery.css">
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">

      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="http://www.abinit.org" title="abinit" class="md-logo md-header-nav__button">
            <img src="../../images/abinit_logo.png" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Lessons
                </span>
              
                <span class="md-header-nav__parent">
                  Many-Body
                </span>
              
            
            Bethe-Salpeter
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="" data-md-lang-tokenizer="[\s\-]+">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/abinit/abinit/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      github-abinit
    </div>
  </a>

          </div>
        </div>
      

      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="dropdown">
          <button class="btn btn-basic btn-sm dropdown-toggle" type="button" data-toggle="dropdown">
            8.5.4
          <span class="caret"></span></button>
          <ul class="dropdown-menu">
            
            <li><a href="#">8.2.0</a></li>
            
            <li><a href="#">8.1.0</a></li>
            
          </ul>
        </div>
      </div>

    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="User Guide" class="md-tabs__link">
          User Guide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../topics/" title="Topics" class="md-tabs__link">
          Topics
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../variables/" title="Variables" class="md-tabs__link">
          Variables
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../welcome/" title="Lessons" class="md-tabs__link md-tabs__link--active">
          Lessons
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../theory/wavefunctions/" title="Theory" class="md-tabs__link">
          Theory
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../developers/abimkdocs/" title="Developers" class="md-tabs__link">
          Developers
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../about/release-notes/" title="About" class="md-tabs__link">
          About
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../../images/abinit_logo.png">
      </i>
    
    abinit
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/abinit/abinit/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      github-abinit
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/help_what_ABINIT_does/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/abinit/" title="Abinit" class="md-nav__link">
      Abinit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/aim/" title="Aim" class="md-nav__link">
      Aim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/anaddb/" title="Anaddb" class="md-nav__link">
      Anaddb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/cut3d/" title="Cut3d" class="md-nav__link">
      Cut3d
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/features/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/fold2bloch/" title="Fold2Bloch" class="md-nav__link">
      Fold2Bloch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/mrgddb/" title="Mrgddb" class="md-nav__link">
      Mrgddb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/mrgscr/" title="Mrgscr" class="md-nav__link">
      Mrgscr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/new_user/" title="NewUser" class="md-nav__link">
      NewUser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/optic/" title="Optic" class="md-nav__link">
      Optic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/respfn/" title="Respfn" class="md-nav__link">
      Respfn
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Topics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Topics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/" title="Topic List" class="md-nav__link">
      Topic List
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Abipy/" title="Abipy" class="md-nav__link">
      Abipy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/APPA/" title="APPA" class="md-nav__link">
      APPA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Artificial/" title="Artificial" class="md-nav__link">
      Artificial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/AtomManipulator/" title="AtomManipulator" class="md-nav__link">
      AtomManipulator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/AtomTypes/" title="AtomTypes" class="md-nav__link">
      AtomTypes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Bader/" title="Bader" class="md-nav__link">
      Bader
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Band2eps/" title="Band2eps" class="md-nav__link">
      Band2eps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Berry/" title="Berry" class="md-nav__link">
      Berry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/BandOcc/" title="BandOcc" class="md-nav__link">
      BandOcc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/BSE/" title="BSE" class="md-nav__link">
      BSE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/ConstrainedPol/" title="ConstrainedPol" class="md-nav__link">
      ConstrainedPol
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Control/" title="Control" class="md-nav__link">
      Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Coulomb/" title="Coulomb" class="md-nav__link">
      Coulomb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/CRPA/" title="CRPA" class="md-nav__link">
      CRPA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/crystal/" title="Crystal" class="md-nav__link">
      Crystal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/DFT+U/" title="DFT+U" class="md-nav__link">
      DFT+U
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/DeltaSCF/" title="DeltaSCF" class="md-nav__link">
      DeltaSCF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/DensityPotential/" title="DensityPotential" class="md-nav__link">
      DensityPotential
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Dev/" title="Dev" class="md-nav__link">
      Dev
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/DFPT/" title="DFPT" class="md-nav__link">
      DFPT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/DMFT/" title="DMFT" class="md-nav__link">
      DMFT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/EffMass/" title="EffMass" class="md-nav__link">
      EffMass
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/EFG/" title="EFG" class="md-nav__link">
      EFG
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Elastic/" title="Elastic" class="md-nav__link">
      Elastic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/ElPhonInt/" title="ElPhonInt" class="md-nav__link">
      ElPhonInt
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/ElPhonTransport/" title="ElPhonTransport" class="md-nav__link">
      ElPhonTransport
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/ElecDOS/" title="ElecDOS" class="md-nav__link">
      ElecDOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/ElecBandStructure/" title="ElecBandStructure" class="md-nav__link">
      ElecBandStructure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/ForcesStresses/" title="ForcesStresses" class="md-nav__link">
      ForcesStresses
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/FrequencyMeshMBPT/" title="FrequencyMeshMBPT" class="md-nav__link">
      FrequencyMeshMBPT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/GeoConstraints/" title="GeoConstraints" class="md-nav__link">
      GeoConstraints
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/GeoOpt/" title="GeoOpt" class="md-nav__link">
      GeoOpt
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Git/" title="Git" class="md-nav__link">
      Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/GSintroduction/" title="GSintroduction" class="md-nav__link">
      GSintroduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/GW/" title="GW" class="md-nav__link">
      GW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/GWls/" title="GWls" class="md-nav__link">
      GWls
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Hybrids/" title="Hybrids" class="md-nav__link">
      Hybrids
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/k-points/" title="K points" class="md-nav__link">
      K points
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/LOTF/" title="LOTF" class="md-nav__link">
      LOTF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/MagField/" title="MagField" class="md-nav__link">
      MagField
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/MagMom/" title="MagMom" class="md-nav__link">
      MagMom
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/MolecularDynamics/" title="MolecularDynamics" class="md-nav__link">
      MolecularDynamics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/multidtset/" title="Multidtset" class="md-nav__link">
      Multidtset
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/nonlinear/" title="Nonlinear" class="md-nav__link">
      Nonlinear
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Optic/" title="Optic" class="md-nav__link">
      Optic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Output/" title="Output" class="md-nav__link">
      Output
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/parallelism/" title="Parallelism" class="md-nav__link">
      Parallelism
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/PAW/" title="PAW" class="md-nav__link">
      PAW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/PIMD/" title="PIMD" class="md-nav__link">
      PIMD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Planewaves/" title="Planewaves" class="md-nav__link">
      Planewaves
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Phonons/" title="Phonons" class="md-nav__link">
      Phonons
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/PhononBands/" title="PhononBands" class="md-nav__link">
      PhononBands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/PhononWidth/" title="PhononWidth" class="md-nav__link">
      PhononWidth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/PortabilityNonRegression/" title="PortabilityNonRegression" class="md-nav__link">
      PortabilityNonRegression
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/positron/" title="Positron" class="md-nav__link">
      Positron
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/printing/" title="Printing" class="md-nav__link">
      Printing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/PseudosPAW/" title="PseudosPAW" class="md-nav__link">
      PseudosPAW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/q-points/" title="Q points" class="md-nav__link">
      Q points
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/RandStopPow/" title="RandStopPow" class="md-nav__link">
      RandStopPow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Recursion/" title="Recursion" class="md-nav__link">
      Recursion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/RPACorrEn/" title="RPACorrEn" class="md-nav__link">
      RPACorrEn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/SCFControl/" title="SCFControl" class="md-nav__link">
      SCFControl
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/SCFAlgorithms/" title="SCFAlgorithms" class="md-nav__link">
      SCFAlgorithms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/SelfEnergy/" title="SelfEnergy" class="md-nav__link">
      SelfEnergy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/SmartSymm/" title="SmartSymm" class="md-nav__link">
      SmartSymm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/spinpolarisation/" title="Spinpolarisation" class="md-nav__link">
      Spinpolarisation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/STM/" title="STM" class="md-nav__link">
      STM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Susceptibility/" title="Susceptibility" class="md-nav__link">
      Susceptibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/TDDFT/" title="TDDFT" class="md-nav__link">
      TDDFT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/TDepES/" title="TDepES" class="md-nav__link">
      TDepES
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Temperature/" title="Temperature" class="md-nav__link">
      Temperature
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/TransPath/" title="TransPath" class="md-nav__link">
      TransPath
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/TuningSpeed/" title="TuningSpeed" class="md-nav__link">
      TuningSpeed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Unfolding/" title="Unfolding" class="md-nav__link">
      Unfolding
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/UnitCell/" title="UnitCell" class="md-nav__link">
      UnitCell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/vdw/" title="Vdw" class="md-nav__link">
      Vdw
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Verification/" title="Verification" class="md-nav__link">
      Verification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Wannier/" title="Wannier" class="md-nav__link">
      Wannier
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Wavelets/" title="Wavelets" class="md-nav__link">
      Wavelets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/xc/" title="Xc" class="md-nav__link">
      Xc
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Variables
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Variables
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/" title="All Variables" class="md-nav__link">
      All Variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Abinit
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Abinit
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/basic/" title="Basic" class="md-nav__link">
      Basic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/bse/" title="Bethe-Salpeter" class="md-nav__link">
      Bethe-Salpeter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/dev/" title="Developers" class="md-nav__link">
      Developers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/dmft/" title="DMFT" class="md-nav__link">
      DMFT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/eph/" title="Electron-Phonon" class="md-nav__link">
      Electron-Phonon
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/ffield/" title="Varff" class="md-nav__link">
      Varff
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/files/" title="File-handling" class="md-nav__link">
      File-handling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/geo/" title="Geometry" class="md-nav__link">
      Geometry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/gstate/" title="Ground-State" class="md-nav__link">
      Ground-State
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/gw/" title="GW" class="md-nav__link">
      GW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/internal/" title="Internal" class="md-nav__link">
      Internal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/paral/" title="Parallelism" class="md-nav__link">
      Parallelism
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/paw/" title="PAW" class="md-nav__link">
      PAW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/dfpt/" title="DFPT" class="md-nav__link">
      DFPT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/rlx/" title="Relaxation" class="md-nav__link">
      Relaxation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/vdw/" title="VdW" class="md-nav__link">
      VdW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/w90/" title="Wannier90" class="md-nav__link">
      Wannier90
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/anaddb/" title="Anaddb" class="md-nav__link">
      Anaddb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/optic/" title="Optic" class="md-nav__link">
      Optic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/aim/" title="Aim" class="md-nav__link">
      Aim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/external_parameters/" title="External Parameters" class="md-nav__link">
      External Parameters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/varset_stats/" title="Statistics" class="md-nav__link">
      Statistics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/connections/" title="Connections" class="md-nav__link">
      Connections
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Lessons
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Lessons
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../welcome/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Base Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Base Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../base1/" title="Base1" class="md-nav__link">
      Base1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../base2/" title="Base2" class="md-nav__link">
      Base2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../base3/" title="Base3" class="md-nav__link">
      Base3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../base4/" title="Base4" class="md-nav__link">
      Base4
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../spin/" title="Spin" class="md-nav__link">
      Spin
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      PAW
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        PAW
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../paw1/" title="PAW1" class="md-nav__link">
      PAW1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paw2/" title="PAW2" class="md-nav__link">
      PAW2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paw3/" title="PAW3" class="md-nav__link">
      PAW3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      DFT_PLUS_U
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        DFT_PLUS_U
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../dftu/" title="Dftu" class="md-nav__link">
      Dftu
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../udet/" title="Udet" class="md-nav__link">
      Udet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ucalc_crpa/" title="Ucalc crpa" class="md-nav__link">
      Ucalc crpa
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      DFPT
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        DFPT
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../rf1/" title="RF1" class="md-nav__link">
      RF1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rf2/" title="RF2" class="md-nav__link">
      RF2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../elastic/" title="Elastic" class="md-nav__link">
      Elastic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ffield/" title="Ffield" class="md-nav__link">
      Ffield
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../nlo/" title="Nlo" class="md-nav__link">
      Nlo
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dmft/" title="DMFT" class="md-nav__link">
      DMFT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-7" type="checkbox" id="nav-4-7">
    
    <label class="md-nav__link" for="nav-4-7">
      EPH
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-7">
        EPH
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../eph/" title="Eph" class="md-nav__link">
      Eph
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tdepes/" title="Tdepes" class="md-nav__link">
      Tdepes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-8" type="checkbox" id="nav-4-8" checked>
    
    <label class="md-nav__link" for="nav-4-8">
      Many-Body
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-8">
        Many-Body
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../gw1/" title="GW1" class="md-nav__link">
      GW1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gw2/" title="GW2" class="md-nav__link">
      GW2
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Bethe-Salpeter
      </label>
    
    <a href="./" title="Bethe-Salpeter" class="md-nav__link md-nav__link--active">
      Bethe-Salpeter
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#absorption-spectra-including-excitonic-effects" title="Absorption spectra including excitonic effects." class="md-nav__link">
    Absorption spectra including excitonic effects.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-preparatory-steps-generating-the-wfk-and-the-scr-file" title="1 Preparatory steps (generating the WFK and the SCR file)" class="md-nav__link">
    1 Preparatory steps (generating the WFK and the SCR file)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-computing-the-absorption-spectrum-within-the-tamm-dancoff-approximation" title="2 Computing the absorption spectrum within the Tamm-Dancoff approximation" class="md-nav__link">
    2 Computing the absorption spectrum within the Tamm-Dancoff approximation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2a-the-structure-of-the-input-file" title="** 2.a The structure of the input file.**" class="md-nav__link">
    ** 2.a The structure of the input file.**
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2c-output-files" title="** 2.c Output files.**" class="md-nav__link">
    ** 2.c Output files.**
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2c-optional-exercises" title="** 2.c Optional Exercises.**" class="md-nav__link">
    ** 2.c Optional Exercises.**
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-convergence-with-respect-to-the-number-of-bands-in-the-transition-space" title="3 Convergence with respect to the number of bands in the transition space" class="md-nav__link">
    3 Convergence with respect to the number of bands in the transition space
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-expert-users" title="For expert users:" class="md-nav__link">
    For expert users:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-convergence-with-respect-to-the-number-of-planewaves-in-the-screening" title="4 Convergence with respect to the number of planewaves in the screening" class="md-nav__link">
    4 Convergence with respect to the number of planewaves in the screening
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-convergence-with-respect-to-the-number-of-k-points" title="5 Convergence with respect to the number of k-points" class="md-nav__link">
    5 Convergence with respect to the number of k-points
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-additional-exercises-optional" title="6 Additional exercises (optional)" class="md-nav__link">
    6 Additional exercises (optional)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-notes-on-the-mpi-implementation" title="7 Notes on the MPI implementation" class="md-nav__link">
    7 Notes on the MPI implementation
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-9" type="checkbox" id="nav-4-9">
    
    <label class="md-nav__link" for="nav-4-9">
      Parallelism
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-9">
        Parallelism
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../basepar/" title="Base" class="md-nav__link">
      Base
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paral_dfpt/" title="DFPT" class="md-nav__link">
      DFPT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paral_gspw/" title="GSPW" class="md-nav__link">
      GSPW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paral_gswvl/" title="GSWVL" class="md-nav__link">
      GSWVL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paral_images/" title="Images" class="md-nav__link">
      Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paral_mbt/" title="Many-Body" class="md-nav__link">
      Many-Body
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paral_moldyn/" title="Moldyn" class="md-nav__link">
      Moldyn
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../analysis_tools/" title="Analysis tools" class="md-nav__link">
      Analysis tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fold2bloch/" title="Fold2bloch" class="md-nav__link">
      Fold2bloch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../nuc/" title="Nuc" class="md-nav__link">
      Nuc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../optic/" title="Optic" class="md-nav__link">
      Optic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../positron/" title="Positron" class="md-nav__link">
      Positron
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../source_code/" title="Source code" class="md-nav__link">
      Source code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tddft/" title="Tddft" class="md-nav__link">
      Tddft
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../wannier90/" title="Wannier90" class="md-nav__link">
      Wannier90
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Theory
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Theory
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/wavefunctions/" title="Wavefunctions" class="md-nav__link">
      Wavefunctions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/mbt/" title="Many-Body Perturbation Theory" class="md-nav__link">
      Many-Body Perturbation Theory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/bse/" title="Bethe-Salpeter" class="md-nav__link">
      Bethe-Salpeter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/documents/" title="Documents" class="md-nav__link">
      Documents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/acknowledgments/" title="Acknowledgments" class="md-nav__link">
      Acknowledgments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/bibliography/" title="Bibliography" class="md-nav__link">
      Bibliography
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/abimkdocs/" title="Abimkdocs" class="md-nav__link">
      Abimkdocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/markdown/" title="Markdown" class="md-nav__link">
      Markdown
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/testsuite/" title="Test Suite" class="md-nav__link">
      Test Suite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/codestats/" title="Code stats" class="md-nav__link">
      Code stats
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/external_resources/" title="External Resources" class="md-nav__link">
      External Resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#absorption-spectra-including-excitonic-effects" title="Absorption spectra including excitonic effects." class="md-nav__link">
    Absorption spectra including excitonic effects.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-preparatory-steps-generating-the-wfk-and-the-scr-file" title="1 Preparatory steps (generating the WFK and the SCR file)" class="md-nav__link">
    1 Preparatory steps (generating the WFK and the SCR file)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-computing-the-absorption-spectrum-within-the-tamm-dancoff-approximation" title="2 Computing the absorption spectrum within the Tamm-Dancoff approximation" class="md-nav__link">
    2 Computing the absorption spectrum within the Tamm-Dancoff approximation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2a-the-structure-of-the-input-file" title="** 2.a The structure of the input file.**" class="md-nav__link">
    ** 2.a The structure of the input file.**
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2c-output-files" title="** 2.c Output files.**" class="md-nav__link">
    ** 2.c Output files.**
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2c-optional-exercises" title="** 2.c Optional Exercises.**" class="md-nav__link">
    ** 2.c Optional Exercises.**
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-convergence-with-respect-to-the-number-of-bands-in-the-transition-space" title="3 Convergence with respect to the number of bands in the transition space" class="md-nav__link">
    3 Convergence with respect to the number of bands in the transition space
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-expert-users" title="For expert users:" class="md-nav__link">
    For expert users:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-convergence-with-respect-to-the-number-of-planewaves-in-the-screening" title="4 Convergence with respect to the number of planewaves in the screening" class="md-nav__link">
    4 Convergence with respect to the number of planewaves in the screening
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-convergence-with-respect-to-the-number-of-k-points" title="5 Convergence with respect to the number of k-points" class="md-nav__link">
    5 Convergence with respect to the number of k-points
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-additional-exercises-optional" title="6 Additional exercises (optional)" class="md-nav__link">
    6 Additional exercises (optional)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-notes-on-the-mpi-implementation" title="7 Notes on the MPI implementation" class="md-nav__link">
    7 Notes on the MPI implementation
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              

                
                
                <h1 id="lesson-on-bethe-salpeter-calculations">Lesson on Bethe-Salpeter calculations<a class="headerlink" href="#lesson-on-bethe-salpeter-calculations" title="Permanent link">&para;</a></h1>
<h2 id="absorption-spectra-including-excitonic-effects">Absorption spectra including excitonic effects.<a class="headerlink" href="#absorption-spectra-including-excitonic-effects" title="Permanent link">&para;</a></h2>
<p>This lesson discusses how to calculate the macroscopic dielectric function
including excitonic effects within the Bethe-Salpeter (BS) approach.
Crystalline silicon is used as test case. A brief description of the formalism
can be found in the Bether-Salpeter noted (<a class="wikilink" href="../../Users/gmatteo/git_repos/abidocs/FAKE_URL">FAKE_URL</a>).</p>
<p>The user should be familiarized with the four basic lessons of ABINIT and the
first lesson of the GW tutorial, see the <a href="../lesson_welcome.html">tutorial home
page</a>.</p>
<p>This lesson should take about one hour to be completed.</p>
<h2 id="1-preparatory-steps-generating-the-wfk-and-the-scr-file">1 Preparatory steps (generating the WFK and the SCR file)<a class="headerlink" href="#1-preparatory-steps-generating-the-wfk-and-the-scr-file" title="Permanent link">&para;</a></h2>
<p><em>Before beginning, you might consider to work in a different subdirectory as
for the other lessons. Why not &ldquo;Work_bs&rdquo; ?</em></p>
<p>In the directory ~abinit/tests/tutorial/Input/Work_bs, copy the files file
~abinit/tests/tutorial/Input/tbs_1.files. Now run immediately the calculation
with the command:</p>
<div class="codehilite"><pre><span></span>abinit &lt; tbs_1.files &gt;&amp; tbs_1.log &amp;
</pre></div>


<p>so that we can analyze the input file while the code is running.</p>
<p>The input file is located in ~abinit/tests/tutorial/Input/tbs_1.in. The header
reports a brief description of the calculation so read it carefully. Don&rsquo;t
worry if some parts are not clear to you as we are going to discuss the
calculation in step by step fashion.</p>
<p>This input file generates the two WFK files and the screening file needed for
the subsequent Bethe-Salpeter computations. The first dataset performs a
rather standard ground-state calculation on an unshifted 4x4x4 grid (64 k
points in the full Brillouin Zone, folding to 8 k points in the irreducible
wedge). Then the ground-state density is used in dataset 2 and 3 to generate
two WFK files with a standard NSCF cycle, solved with the conjugate-gradient
method.</p>
<p>Note that the WFK file computed in dataset 2 contains 100 bands on the 4x4x4
gamma-centered k-mesh whereas the WFK file produced in dataset 3 has only 10
bands on a 4x4x4 k-mesh that has been shifted along the direction</p>
<div class="codehilite"><pre><span></span>shiftk3    0.11 0.21 0.31  # This shift breaks the symmetry of the k-mesh.
</pre></div>


<p>The gamma-centered k-mesh contains 8 points in the irreducible zone while the
shifted k-mesh breaks the symmetry of the crystal leading to 64 points in the
IBZ (actually the IBZ now coincides with the full Brillouin zone). The second
mesh is clearly inefficient, so you might wonder why we are using such a
bizarre sampling and, besides, why we need to generate two different WFK
files!</p>
<p>Indeed this approach strongly differs from the one we followed in the GW
tutorials, but there is a good reason for doing so. It is anticipated that
optical spectra converge slowly with the Brillouin zone sampling, and that
symmetry-breaking k-meshes lead to faster convergence in <a class="wikilink codevar-link" href="../../variables/basic#nkpt">nkpt</a> than the
standard symmetric k-meshes commonly used for ground-state or GW calculations.</p>
<p>This explains the bizarre shift but still why two WFK files? Why don&rsquo;t we
simply use the WFK file on the shifted k-mesh to compute the screening?</p>
<p>The reason is that a screening calculation done with many empty bands on the
shifted k-mesh would be very memory demanding as the code should allocate a
huge portion of memory whose size scales with (<a class="wikilink codevar-link" href="../../variables/basic#nband">nband</a> * <a class="wikilink codevar-link" href="../../variables/basic#nkpt">nkpt</a>), and no
symmetry can be used to reduce the number of k-points.</p>
<p>To summarize: the WFK with the symmetric k-point sampling and 100 bands will
be used to compute the screening, while the WFK file with the shifted k-mesh
and 10 bands will be used to construct the transition space employed for
solving the Bethe-Salpeter equation. The two k-meshes differ just for the
shift thus they produce the same set of q-points (the list of q-points in the
screening is defined as all the possible differences between the k-points of
the WFK file). This means that, in the BS run, we can use the SCR file
generated with the symmetric mesh even though the transition space is
constructed with the shifted k-mesh.</p>
<p>After this lengthy discussion needed to clarify this rather technical point,
we can finally proceed to analyze the screening computation performed in the
last dataset of tbs_1.in.</p>
<p>The SCR file is calculated in dataset 4 using <a class="wikilink codevar-link" href="../../variables/basic#nband">nband</a>=100 and <a class="wikilink codevar-link" href="../../variables/gw#ecuteps">ecuteps</a>
6.0 Ha. In the <a href="../lesson_gw1.html">first lesson</a> of the GW tutorial, these
values were found to give QP energies converged within 0.01 eV, so we are
confident that our SCR file is well converged and it can be safely used for
performing convergence tests in the Bethe-Salpeter part.</p>
<p>Note that, for efficiency reasons, only the static limit of W is computed:</p>
<div class="codehilite"><pre><span></span>nfreqre4  1     # Only the static limit of W is needed for standard BSE calculations.
nfreqim4  0
</pre></div>


<p>Indeed, in the standard formulation of the Bethe-Salpeter equation, only the
static limit of the screened interaction is needed to construct the Coulomb
term of the BS Hamiltonian. Using a single frequency allows us to save some
CPU time in the screening part, but keep in mind that this SCR file can only
be used either for Bethe-Salpeter computations or for GW calculations
employing the plasmon-pole models corresponding to <a class="wikilink codevar-link" href="../../variables/gw#ppmodel">ppmodel</a>=3,4.</p>
<p>At this point the calculation should have completed, but there&rsquo;s still one
thing that we have to do before moving to the next paragraph.</p>
<p>As we said, we will need the WFK file on the shifted k-mesh and the SCR file
for our BS calculations so do not delete them! It is also a good idea to
rename these precious files using more meaningful names e.g.:</p>
<div class="codehilite"><pre><span></span>mv tbs_1o_DS2_WFK 444_gamma_WFK
mv tbs_1o_DS3_WFK 444_shifted_WFK
mv tbs_1o_DS4_SCR 444_SCR
</pre></div>


<p>Keep in mind that henceforth the k-point sampling cannot be changed anymore:
the list of k-points specified in the BS input files MUST equal the one used
to generate the WFK file. Two new WFK files and a new SCR file must be
generated from scratch if we want to change the k-point sampling used to
construct the transition space.</p>
<h2 id="2-computing-the-absorption-spectrum-within-the-tamm-dancoff-approximation">2 Computing the absorption spectrum within the Tamm-Dancoff approximation<a class="headerlink" href="#2-computing-the-absorption-spectrum-within-the-tamm-dancoff-approximation" title="Permanent link">&para;</a></h2>
<p>This section is intended to show how to perform a standard excitonic
calculation within the Tamm-Dancoff approximation (TDA) using the Haydock
iterative technique. The input file is ~abinit/tests/tutorial/Input/tbs_2.in.</p>
<p>Before running the job, we have to connect this calculation with the output
results produced in tbs_1.in.</p>
<p>Use the Unix commands:</p>
<div class="codehilite"><pre><span></span>ln -s 444_shifted_WFK tbs_2i_WFK
ln -s 444_SCR tbs_2i_SCR
</pre></div>


<p>to create two symbolic links for the shifted WFK and the SCR file. The reason
for doing so will be clear afterwards once we discuss the input file.</p>
<p>This job lasts 1-2 minutes on a modern machine so it is worth running it
before inspecting the input file.</p>
<p>Copy the files file ~abinit/tests/tutorial/Input/tbs_2.files in the working
directory and issue</p>
<div class="codehilite"><pre><span></span>abinit &lt; tbs_2.files &gt;&amp; tbs_2.log &amp;
</pre></div>


<p>to put the job in background so that we can examine tbs_2.in.</p>
<p>Now open ~abinit/tests/tutorial/Input/tbs_2.in in your preferred editor and go
to the next section where we discuss the most important variables governing a
typical BS computation.</p>
<h4 id="_1"><a class="headerlink" href="#_1" title="Permanent link">&para;</a></h4>
<h4 id="2a-the-structure-of-the-input-file">** 2.a The structure of the input file.**<a class="headerlink" href="#2a-the-structure-of-the-input-file" title="Permanent link">&para;</a></h4>
<p>First we need to set <a class="wikilink codevar-link" href="../../variables/gstate#optdriver">optdriver</a>=99 to call the BSE routines</p>
<div class="codehilite"><pre><span></span>optdriver  99        # BS calculation
</pre></div>


<p>The variables <a class="wikilink codevar-link" href="../../variables/files#irdwfk">irdwfk</a> and <a class="wikilink codevar-link" href="../../variables/files#irdscr">irdscr</a> are similar to other &ldquo;ird&rdquo; variables
of ABINIT and are used to read the files produced in the previous paragraph</p>
<div class="codehilite"><pre><span></span>irdwfk  1     # Read the WFK file produced in tbs_1 
irdscr  1     # Read the SCR file produced in tbs_1
</pre></div>


<p>The code expects to find an input WFK file and an input SCR file whose name is
constructed according to prefix specified in the files file tbs_2.files (see
<a href="../../../users/generated_files/help_abinit.html#intro1">section 1.1</a> of the
abinit_help file). This is the reason why we had to create the two symbolic
links before running the code.</p>
<p>Then we have a list of five variables specifying how to construct the
excitonic Hamiltonian.</p>
<div class="codehilite"><pre><span></span>bs_calctype       1       # L0 is constructed with KS orbitals and energies.
mbpt_sciss          0.8 eV  # Scissors operator used to correct the KS band structure.
bs_exchange_term  1       # Exchange term included.
bs_coulomb_term  11       # Coulomb term included using the full matrix W_GG&#39;
bs_coupling       0       # Tamm-Dancoff approximation.
</pre></div>


<p>The value <a class="wikilink codevar-link" href="../../variables/bse#bs_calctype">bs_calctype</a>=1 specifies that the independent-particle
polarizability should be costructed with the Kohn-Sham orbitals and energies
read from the WFK file. To simulate the self-energy correction, the KS
energies are corrected with a scissors operator of energy <a class="wikilink codevar-link" href="../../variables/gw#mbpt_sciss">mbpt_sciss</a>= 0.8
eV. This permits us to avoid a cumbersome GW calculation for each state
included in our transition space. The use of the scissors operator is a
reasonable approximation for silicon but it might fail in more complicated
systems in which the GW corrections cannot be simulated in terms of a simple
rigid shift of the initial KS bands structure.</p>
<p>The remaining three variables specify how to construct the excitonic
Hamiltonian. <a class="wikilink codevar-link" href="../../variables/bse#bs_exchange_term">bs_exchange_term</a>=1 tells the program to calculate the exchage
part of the kernel, hence this calculation includes local-field effects. The
variable <a class="wikilink codevar-link" href="../../variables/bse#bs_coulomb_term">bs_coulomb_term</a> is used to select among different options that
are available for the Coulomb term (please take some time to read the
description of the variable and the relevant equations in the Bethe-Salpeter
notes (<a class="wikilink" href="../../Users/gmatteo/git_repos/abidocs/FAKE_URL">FAKE_URL</a>). Finally <a class="wikilink codevar-link" href="../../variables/bse#bs_coupling">bs_coupling</a>=0 specifies that the off-
diagonal coupling blocks should be neglected (Tamm-Dancoff approximation).
This particular combination of parameters thus corresponds to a Bethe-Salpeter
calculation within the Tamm-Dancoff approximation with local field effects
included.</p>
<p>Then we have the specification of the bands used to construct the transition
space:</p>
<div class="codehilite"><pre><span></span>bs_loband         2 
nband             8
</pre></div>


<p>In this case all the bands around the gap whose index is between 2 and 8 are
included in the basis set.</p>
<p>The frequency mesh for the macroscopic dielectric function is specified
through <a class="wikilink codevar-link" href="../../variables/bse#bs_freq_mesh">bs_freq_mesh</a></p>
<div class="codehilite"><pre><span></span>bs_freq_mesh 0 6 0.02 eV  # Frequency mesh.
</pre></div>


<p>This triplet of real values defines a linear mesh that covers the range [0,6]
eV with a step of 0.02 eV. The number of frequency points in the mesh does not
have any significant effect on the CPU time, but it is important to stress
that the number of bands included in the transition space defines, in
conjunction with the number of k-points, the frequency range that can be
described. As a consequence <a class="wikilink codevar-link" href="../../variables/bse#bs_loband">bs_loband</a> and <a class="wikilink codevar-link" href="../../variables/basic#nband">nband</a> should be subject to
an accurate converge study.</p>
<p>Then we have the parameters that define and control the algorithm employed to
calculate the macroscopic dielectric function</p>
<div class="codehilite"><pre><span></span>bs_algorithm        2      # Haydock method (this is the default value).
bs_haydock_niter   100     # Max number of iterations for the Haydock method.
bs_haydock_tol     0.05    # Tolerance for the iterative method.
zcut               0.15 eV # Complex shift to avoid divergences in the continued fraction.
</pre></div>


<p><a class="wikilink codevar-link" href="../../variables/bse#bs_algorithm">bs_algorithm</a> specifies the algorithm used to calculate the macroscopic
dielectric function. In this case we use the iterative Haydock technique whose
maximum number of iterations is given by <a class="wikilink codevar-link" href="../../variables/bse#bs_haydock_niter">bs_haydock_niter</a>. The iterative
algorithm stops when the difference between two consecutive evaluations of the
optical spectra is less than <a class="wikilink codevar-link" href="../../variables/bse#bs_haydock_tol">bs_haydock_tol</a>. The input variable <a class="wikilink codevar-link" href="../../variables/gw#zcut">zcut</a>
gives the complex shift to avoid divergences in the continued fraction. From a
physical point of view, this parameters mimics the experimental broadening of
the absorption peaks. In this test, due to the coarseness of the k-mesh, we
have to use a value slightly larger than the default one (0.1 eV) in order to
facilitate the convergence of the Haydock algorithm. Ideally, one should make
a convergence study decreasing the value of <a class="wikilink codevar-link" href="../../variables/gw#zcut">zcut</a> for increasing number of
k-points.</p>
<p>The k-point sampling is specified by the set of variables.</p>
<div class="codehilite"><pre><span></span># Definition of the k-point grid
kptopt 1                  # Option for the automatic generation of k points,
ngkpt  4 4 4              # This mesh is too coarse for optical properties.
nshiftk 1
shiftk    0.11 0.21 0.31  # This shift breaks the symmetry of the k-mesh.
chksymbreak 0             # Mandatory for using symmetry-breaking k-meshes in the BS code.
</pre></div>


<p>The values of <a class="wikilink codevar-link" href="../../variables/basic#kptopt">kptopt</a>, <a class="wikilink codevar-link" href="../../variables/basic#ngkpt">ngkpt</a>, <a class="wikilink codevar-link" href="../../variables/basic#nshiftk">nshiftk</a>, and <a class="wikilink codevar-link" href="../../variables/basic#shiftk">shiftk</a> MUST equal
the ones used to specify the grid for the WFK file. <a class="wikilink codevar-link" href="../../variables/gstate#chksymbreak">chksymbreak</a>=0 is used
to bypass the check on symmetry breaking that, otherwise, would make the code
stop.</p>
<p>The last section of the input file</p>
<div class="codehilite"><pre><span></span>ecutwfn 8.0               # Cutoff for the wavefunction.
ecuteps 2.0               # Cutoff for W and /bare v used to calculate the BS matrix elements.
inclvkb 2                 # The Commutator for the optical limit is correctly evaluated.
</pre></div>


<p>specifies the parameters used to calculate the kernel matrix elements and the
matrix elements of the dipole operator. We have already encountered these
variables in the <a href="../lesson_gw1.html">first lesson</a> of the GW tutorial so their
meaning is (hopefully) familiar to you. A more detailed discussion of the role
played by these variables in the BS code can be found in the Bether-Salpeter
notes<a class="wikilink" href="../../Users/gmatteo/git_repos/abidocs/FAKE_URL">FAKE_URL</a>.</p>
<h4 id="_2"><a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<h4 id="2c-output-files">** 2.c Output files.**<a class="headerlink" href="#2c-output-files" title="Permanent link">&para;</a></h4>
<p>The output file, tbs_2.out, reports the basic parameters of the calculation
and eventual WARNINGs that are issued if the iterative method does not
converge. Please take some time to understand its structure.</p>
<p>Could you answer the following questions?</p>
<ol>
<li>How many transitions are included in the basis set? </li>
<li>How many directions are used to evaluate the optical limit? </li>
<li>What is the value of the Lorentzian broadening used in the continued fraction? </li>
</ol>
<p>After this digression on the main output file, we can finally proceed to
analyse the output data of the computation.</p>
<p>The most important results are stored in five different files:</p>
<ul>
<li>tbs_2o_BSR </li>
<li>tbs_2o_HAYDR_SAVE </li>
<li>tbs_2o_RPA_NLF_MDF </li>
<li>tbs_2o_GW_NLF_MDF </li>
<li>
<p>tbs_2o_EXC_MDF 
In what follows, we provide a brief description of the format and of the
content of each output file.</p>
</li>
<li>
<p>tbs_2o_BSR: </p>
</li>
</ul>
<p>This binary file stores the upper triangle of the resonant block (the matrix
is Hermitian hence only the non-redundant part is computed and saved on file).
The BSR file can be used to restart the run from a previous computation using
the variables <a class="wikilink codevar-link" href="../../variables/files#getbsreso">getbsreso</a> or <a class="wikilink codevar-link" href="../../variables/files#irdbsreso">irdbsreso</a>. This restart capability is
useful for restarting the Haydock method if convergence was not achieved or to
execute Haydock computations with different values of <a class="wikilink codevar-link" href="../../variables/gw#zcut">zcut</a>. <a class="wikilink codevar-link" href="../../variables/files#getbsreso">getbsreso</a>
and <a class="wikilink codevar-link" href="../../variables/files#irdbsreso">irdbsreso</a> are also handy if one wants to include the coupling on top
of a pre-existing TDA calculation since the code uses two different files to
store the resonant and the coupling block (BSC is the prefix used for the
files storing the coupling term).</p>
<ul>
<li>tbs_2o_HAYDR_SAVE: </li>
</ul>
<p>It is a binary file containing the results of the Haydock method: the
coefficient of the tridiagonal matrix and the three vectors employed in the
iterative algorithm. It is usually used to restart the algorithm if
convergence has not been achieved (see the related input variables
<a class="wikilink codevar-link" href="../../variables/files#gethaydock">gethaydock</a> and <a class="wikilink codevar-link" href="../../variables/files#irdhaydock">irdhaydock</a>).</p>
<ul>
<li>tbs_2o_RPA_NLF_MDF and tbs_2o_GW_NLF_MDF </li>
</ul>
<p>The RPA spectrum without local field effects obtained with KS energies and the
GW energies, respectively (mnemonics: NLF stands for No Local Field, while MDF
stands for Macroscopic Dielectric Function).</p>
<ul>
<li>tbs_2o_EXC_MDF: </li>
</ul>
<p>Formatted file reporting the macroscopic dielectric function with excitonic
effects. Since this file contains the most important results of our
calculation it is worth spending some time to discuss its format.</p>
<p>First we have a header reporting the basic parameters of the calculation</p>
<div class="codehilite"><pre><span></span># Macroscopic dielectric function obtained with the BS equation.
#  RPA L0 with KS energies and KS wavefunctions     LOCAL FIELD EFFECTS INCLUDED
# RESONANT-ONLY calculation
# Coulomb term constructed with full W(G1,G2)
# Scissor operator energy =  0.8000 [eV]
# Tolerance =  0.0500
# npweps  = 27
# npwwfn  = 283
# nbands  = 8
# loband  = 2
# nkibz   = 64
# nkbz    = 64
# Lorentzian broadening =  0.1500 [eV]
</pre></div>


<p>then the list of q-points giving the direction of the incident photon:</p>
<div class="codehilite"><pre><span></span><span class="cp">#  List of q-points for the optical limit:</span>
<span class="cp"># q =  0.938821, 0.000000, 0.000000, [Reduced coords] </span>
<span class="cp"># q =  0.000000, 0.938821, 0.000000, [Reduced coords] </span>
<span class="cp"># q =  0.000000, 0.000000, 0.938821, [Reduced coords] </span>
<span class="cp"># q =  0.000000, 0.813043, 0.813043, [Reduced coords] </span>
<span class="cp"># q =  0.813043, 0.000000, 0.813043, [Reduced coords] </span>
<span class="cp"># q =  0.813043, 0.813043, 0.000000, [Reduced coords]</span>
</pre></div>


<p>By default the code calculates the macroscopic dielectric function considering
six different directions in q-space (the three basis vectors of the reciprocal
lattice and the three Cartesian axis). It is possible to specify custom
directions using the input variables <a class="wikilink codevar-link" href="../../variables/gw#gw_nqlwl">gw_nqlwl</a> and <a class="wikilink codevar-link" href="../../variables/gw#gw_qlwl">gw_qlwl</a>.</p>
<p>Then comes the section with the real and the imaginary part of the macroscopic
dielectric as a function of frequency for the different directions:</p>
<div class="codehilite"><pre><span></span># omega [eV]    RE(eps(q=1)) IM(eps(q=1) RE(eps(q=2) ) ... 
0.000  1.8026E+01  0.0000E+00  1.7992E+01  0.0000E+00  1.4292E+01  0.0000E+00  1.3993E+01 0.0000E+00  1.7117E+01  0.0000E+00  1.7080E+01  0.0000E+00
  .... .... ...
</pre></div>


<p>You can visualize the data using your preferred software. For instance,</p>
<div class="codehilite"><pre><span></span>&gt;&gt;&gt; gnuplot
gnuplot&gt;  p &quot;tbs_2o_EXC_MDF&quot; u 1:3 w l
</pre></div>


<p>will plot the imaginary part of the macroscopic dielectric function (the
absorption spectrum) for the first q-point. You should obtain a graphic
similar to the one reported below</p>
<p><img alt="" src="../../documents/lesson_bse/tbs2_1.png" /></p>
<p>Please note that these results are not converged, we postpone the discussion
about convergence tests to the next paragraphs of this tutorial.</p>
<p>The most important feature of the spectrum is the presence of two peaks
located at around 3.4 and 4.3 eV. To understand the nature of these peaks and
the role played by the BS kernel, it is useful to compare the excitonic
spectra with the RPA results obtained without local field effects.</p>
<p>Use the sequence of gnuplot command</p>
<div class="codehilite"><pre><span></span>&gt;&gt;&gt; gnuplot
gnuplot&gt;  p   &quot;tbs_2o_EXC_MDF&quot;     u 1:3 w l
gnuplot&gt;  rep &quot;tbs_2o_RPA_NLF_MDF&quot; u 1:3 w l
gnuplot&gt;  rep &quot;tbs_2o_GW_NLF_MDF&quot;  u 1:3 w l
</pre></div>


<p>to plot the absorption spectrum obtained with the three different approaches.
The final result is reported in the figure below.</p>
<p><img alt="" src="../../documents/lesson_bse/tbs2_2.png" /></p>
<p>The RPA-KS spectrum underestimates the experimental optical threshold due to
the well know band gap problem of DFT. Most importantly, the amplitude of the
first peak is underestimated, a problem than is not solved when local-field
effects are correctly included in the calculation.</p>
<p>The RPA-GW results with QP corrections simulated with <a class="wikilink codevar-link" href="../../variables/gw#mbpt_sciss">mbpt_sciss</a> does not
show any significant improvement over RPA-KS: the RPA-GW spectrum is just
shifted towards higher frequencies due to opening of the gap, but the shape of
the two spectra is very similar, in particular the amplitude of the first peak
is still underestimated.</p>
<p>On the contrary, the inclusion of the BS kernel leads to important changes
both in the optical threshold as well as in the amplitude of the first peak.
This simple analysis tells us that the first peak in the absorption spectrum
of silicon has a strong excitonic character that is not correctly described
within the RPA. Our first BS spectrum is not converged at all and it barely
resembles the experimental result, nevertheless this unconverged calculation
is already able to capture the most important physics.</p>
<h4 id="_3"><a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<h4 id="2c-optional-exercises">** 2.c Optional Exercises.**<a class="headerlink" href="#2c-optional-exercises" title="Permanent link">&para;</a></h4>
<ul>
<li>Change the value of the Lorentzian broadening <a class="wikilink codevar-link" href="../../variables/gw#zcut">zcut</a> used to avoid divergences in the continued fraction. Then restart the Haydock algorithm from the _BSR and _HAYDR_SAVE files using the appropriate variables. What is the main effect of the broadening on the final spectrum. Does the number of iterations needed to converge depend on the broadening? </li>
<li>Use the appropriate values for <a class="wikilink codevar-link" href="../../variables/bse#bs_exchange_term">bs_exchange_term</a> and <a class="wikilink codevar-link" href="../../variables/bse#bs_coulomb_term">bs_coulomb_term</a> to calculate the BS spectrum without local field effects. Compare the results obtained with and without local field effects. </li>
<li>Modify the input file tbs_2.in so that the code reads in the resonant block produced in the previous run and calculates the spectrum employing the method based on the direct diagonalization (use <a class="wikilink codevar-link" href="../../variables/files#irdbsreso">irdbsreso</a> to restart the run but remember to rename the file with the resonant block). Compare the CPU time needed by the two algorithms as a function of the number of transitions in the transition space. Which one has the best scaling? </li>
</ul>
<h4 id="_4"><a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<p>**2.d Preliminary discussion about convergence studies **</p>
<p>Converging the excitonic spectrum requires a careful analysis of many
different parameters:</p>
<ul>
<li><a class="wikilink codevar-link" href="../../variables/bse#bs_loband">bs_loband</a> </li>
<li><a class="wikilink codevar-link" href="../../variables/basic#nband">nband</a> </li>
<li><a class="wikilink codevar-link" href="../../variables/gw#ecutwfn">ecutwfn</a> </li>
<li><a class="wikilink codevar-link" href="../../variables/gw#ecuteps">ecuteps</a> </li>
<li><a class="wikilink codevar-link" href="../../variables/basic#ngkpt">ngkpt</a> </li>
<li><a class="wikilink codevar-link" href="../../variables/basic#nshiftk">nshiftk</a> </li>
<li><a class="wikilink codevar-link" href="../../variables/basic#shiftk">shiftk</a> 
Since the memory requirements scale quadratically with the number of k-points
in the <em><strong>full</strong></em> Brillouin zone <em><strong>times</strong></em> the number of valence bands
<em><strong>times</strong></em> the number of conduction bands included in the transition space,
it is very important to find a good compromise between accuracy and
computational efficiency.</li>
</ul>
<p>First of all one should select the frequency range of interest since this
choice has an important effect on the number of valence and conduction states
that have to be included in the transition space. The optical spectrum is
expected to converge faster in the number of bands than the GW corrections
since only those transitions whose energy is &ldquo;close&rdquo; to the frequency range
under investigation are expected to contribute.</p>
<p><a class="wikilink codevar-link" href="../../variables/gw#ecutwfn">ecutwfn</a> usually plays a secondary role since it only affects the accuracy
of the oscillator matrix elements. We suggest avoiding any truncation of the
initial basis set by setting <a class="wikilink codevar-link" href="../../variables/gw#ecutwfn">ecutwfn</a> to a value slightly larger than the
value of <a class="wikilink codevar-link" href="../../variables/basic#ecut">ecut</a> used to generate the WFK file. One should truncate the
initial planewave basis set only when experiencing memory problems although
this kind of problems can be usually solved by just increasing the number of
processors or, alternatively, with an appropriate choice of <a class="wikilink codevar-link" href="../../variables/gw#gwmem">gwmem</a>.</p>
<p>The value of <a class="wikilink codevar-link" href="../../variables/gw#ecuteps">ecuteps</a> affects the accuracy of the matrix elements of the
Coulomb term, the fundamental term that drives the creation of the excitons.
As a consequence <a class="wikilink codevar-link" href="../../variables/gw#ecuteps">ecuteps</a> should be subject to an accurate convergence
test. As a rule of thumb, <a class="wikilink codevar-link" href="../../variables/gw#ecuteps">ecuteps</a> can be chosen equal or, sometimes, even
smaller than the value needed to converge the GW corrections.</p>
<p>As already stated: optical spectra converge slowly with the Brillouin zone
sampling. The convergence in the number of k-points thus represents the most
important and tedious part of our convergence study. For this reason, this
study should be done once converged values for the other parameters have been
already found.</p>
<h2 id="3-convergence-with-respect-to-the-number-of-bands-in-the-transition-space">3 Convergence with respect to the number of bands in the transition space<a class="headerlink" href="#3-convergence-with-respect-to-the-number-of-bands-in-the-transition-space" title="Permanent link">&para;</a></h2>
<p>In this section we take advantage of the multi-dataset capabilities of ABINIT
to perform calculations with different values for <a class="wikilink codevar-link" href="../../variables/bse#bs_loband">bs_loband</a> and <a class="wikilink codevar-link" href="../../variables/basic#nband">nband</a></p>
<p>Before running the test take some time to read the input file
~abinit/tests/tutorial/Input/tbs_3.in.</p>
<p>The convergence in the number of transitions is performed by defining five
datasets with different values for <a class="wikilink codevar-link" href="../../variables/basic#nband">nband</a> and <a class="wikilink codevar-link" href="../../variables/bse#bs_loband">bs_loband</a></p>
<div class="codehilite"><pre><span></span>ndtset     5
bs_loband1  4 nband1  5
bs_loband2  3 nband2  6
bs_loband3  2 nband3  7
bs_loband4  2 nband4  8
bs_loband5  1 nband5  8
</pre></div>


<p>The parameters defining how to build the excitonic Hamiltonian are similar to
the ones used in tbs_2.in. The only difference is in the value used for
<a class="wikilink codevar-link" href="../../variables/bse#bs_coulomb_term">bs_coulomb_term</a>, i.e.</p>
<div class="codehilite"><pre><span></span>bs_coulomb_term      10 # Coulomb term evaluated within the diagonal approximation.
</pre></div>


<p>that allows us to save some CPU time during the computation of the Coulomb
term.</p>
<p>Also in this case, before running the test, we have to connect tbs_3.in to the
WFK and the SCR file produced in the first step. Note that tbs_3.in uses
<a class="wikilink codevar-link" href="../../variables/files#irdwfk">irdwfk</a> and <a class="wikilink codevar-link" href="../../variables/files#irdscr">irdscr</a> to read the external files, hence we have to create
symbolic links for each dataset:</p>
<div class="codehilite"><pre><span></span>ln -s 444_SCR tbs_3i_DS1_SCR
ln -s 444_SCR tbs_3i_DS2_SCR
ln -s 444_SCR tbs_3i_DS3_SCR
ln -s 444_SCR tbs_3i_DS4_SCR
ln -s 444_SCR tbs_3i_DS5_SCR
ln -s 444_shifted_WFK tbs_3i_DS1_WFK
ln -s 444_shifted_WFK tbs_3i_DS2_WFK
ln -s 444_shifted_WFK tbs_3i_DS3_WFK
ln -s 444_shifted_WFK tbs_3i_DS4_WFK
ln -s 444_shifted_WFK tbs_3i_DS5_WFK
</pre></div>


<p>Now we can finally run the test with</p>
<div class="codehilite"><pre><span></span>abinit &lt; tbs_3.files &gt;&amp; tbs3.log &amp;
</pre></div>


<p>This job should last 3-4 minutes so be patient!</p>
<p>Let us hope that your calculation has been completed, and that we can examine
the output results.</p>
<p>Use the following sequence of gnuplot commands:</p>
<div class="codehilite"><pre><span></span>&gt;&gt;&gt; gnuplot
gnuplot&gt; p   &quot;tbs_3o_DS1_EXC_MDF&quot; u 1:3 w l
gnuplot&gt; rep &quot;tbs_3o_DS2_EXC_MDF&quot; u 1:3 w l
gnuplot&gt; rep &quot;tbs_3o_DS3_EXC_MDF&quot; u 1:3 w l
gnuplot&gt; rep &quot;tbs_3o_DS4_EXC_MDF&quot; u 1:3 w l
gnuplot&gt; rep &quot;tbs_3o_DS5_EXC_MDF&quot; u 1:3 w l
</pre></div>


<p>to plot on the same graphic the absorption spectrum obtained with different
transition spaces. You should obtain a graphic similar to this one:</p>
<p><img alt="" src="../../documents/lesson_bse/tbs3.png" /></p>
<p>The results obtained with (<a class="wikilink codevar-link" href="../../variables/bse#bs_loband">bs_loband</a>=4, <a class="wikilink codevar-link" href="../../variables/basic#nband">nband</a>=5) are clearly
unconverged as the basis set contains too few transitions that are not able to
describe the frequency-dependence of the polarizability in the energy range
under investigation. For a well converged spectrum, we have to include the
three higher occupied states and the first four conduction bands (the blue
curve corresponding to <a class="wikilink codevar-link" href="../../variables/bse#bs_loband">bs_loband</a>=2, and <a class="wikilink codevar-link" href="../../variables/basic#nband">nband</a>=8).</p>
<p>Note that adding the first occupied band, curve (1-8), gives results that are
almost on top of (2,8). This is due to the fact that, in silicon, the bottom
of the first band is located at around 12 eV from the top of the conduction
band therefore its inclusion does not lead to any significant improvement of
the transition space in the frequency range [0,8] eV. For completeness, we
also report the results obtained in a separate calculation done with
<a class="wikilink codevar-link" href="../../variables/bse#bs_loband">bs_loband</a>=2 <a class="wikilink codevar-link" href="../../variables/basic#nband">nband</a>=9 to show that four empty states are enough to
converge the spectrum.</p>
<p>We therefore fix the number of bands for the transition space using the
converged values <a class="wikilink codevar-link" href="../../variables/bse#bs_loband">bs_loband</a>=2, <a class="wikilink codevar-link" href="../../variables/basic#nband">nband</a>=8, and we proceed to analyse the
convergence of the spectrum with respect to the number of planewaves in the
screening.</p>
<h4 id="for-expert-users">For expert users:<a class="headerlink" href="#for-expert-users" title="Permanent link">&para;</a></h4>
<p>The use of <a class="wikilink codevar-link" href="../../variables/files#irdwfk">irdwfk</a> and <a class="wikilink codevar-link" href="../../variables/files#irdscr">irdscr</a> is not handy when we have several
datasets that are reading the SAME external file as we are forced to use
different names for the input of each dataset. To work around this annoyance,
one can introduce a fictitious dataset (say dataset 99), and let the code use
the output of this nonexistent dataset as the input of the real datasets. An
example will help clarify: Instead of using the lengthy list of links as done
before, we might use the much simpler sequence of commands</p>
<div class="codehilite"><pre><span></span>ln -s 444_shifted_WFK tbs_3o_DS99_WFK
ln -s 444_SCR         tbs_3o_DS99_SCR
</pre></div>


<p>provided that, in the input file, we replace <a class="wikilink codevar-link" href="../../variables/files#irdwfk">irdwfk</a> and <a class="wikilink codevar-link" href="../../variables/files#irdscr">irdscr</a> with</p>
<div class="codehilite"><pre><span></span>getwfk  99              # Trick to read the same file tbs_o3_DS99_WFK in each dataset
getscr  99              # Same trick for the SCR file
</pre></div>


<hr />
<h2 id="4-convergence-with-respect-to-the-number-of-planewaves-in-the-screening">4 Convergence with respect to the number of planewaves in the screening<a class="headerlink" href="#4-convergence-with-respect-to-the-number-of-planewaves-in-the-screening" title="Permanent link">&para;</a></h2>
<p>First of all, before running the calculation, take some time to understand
what is done in ~abinit/tests/tutorial/Input/tbs_4.in.</p>
<p>The structure of the input file is very similar to the one of tbs_3.in, the
main difference is in the first section:</p>
<div class="codehilite"><pre><span></span>ndtset 4
ecuteps: 1 ecuteps+ 2 
bs_coulomb_term 11
</pre></div>


<p>that instructs the code to execute four calculations where the direct term is
constructed using different value of <a class="wikilink codevar-link" href="../../variables/gw#ecuteps">ecuteps</a>. We also relax the diagonal-
only approximation for the screening by setting <a class="wikilink codevar-link" href="../../variables/bse#bs_coulomb_term">bs_coulomb_term</a>=11 so that
the non-locality of W(r,r&rsquo;) is correctly taken into account.</p>
<p>It is important to stress that it is not necessary to recalculate the SCR file
from scratch just to modify the value of <a class="wikilink codevar-link" href="../../variables/gw#ecuteps">ecuteps</a> used in the BS run. The
SCR file calculated in the preparatory step contains G-vectors whose energy
extends up to ecuteps=6.0 Ha. This is the MAXIMUM cutoff energy that can be
used in our convergence tests. If the value of <a class="wikilink codevar-link" href="../../variables/gw#ecuteps">ecuteps</a> specified in the
input file is smaller than the one stored on disk, the code will read a sub-
block of the initial matrix. A WARNING message is issued if the value
specified in the input file is larger than the one available in the SCR file.</p>
<p>Now we can finally run the calculation. As usual, we have to copy
~abinit/tests/tutorial/Input/tbs_4.files in the working directory Work_bs,
then we have to create a bunch of symbolic links for the input WFK and SCR
files:</p>
<div class="codehilite"><pre><span></span>ln -s 444_SCR tbs_4i_DS1_SCR
ln -s 444_SCR tbs_4i_DS2_SCR
ln -s 444_SCR tbs_4i_DS3_SCR
ln -s 444_SCR tbs_4i_DS4_SCR
ln -s 444_shifted_WFK tbs_4i_DS1_WFK
ln -s 444_shifted_WFK tbs_4i_DS2_WFK
ln -s 444_shifted_WFK tbs_4i_DS3_WFK
ln -s 444_shifted_WFK tbs_4i_DS4_WFK
</pre></div>


<p>Now issue</p>
<div class="codehilite"><pre><span></span>abinit &lt; tbs_4.files &gt;&amp; tbs4.log &amp;
</pre></div>


<p>to execute the test (it should take around 2 minutes).</p>
<p>Once the calculation is completed, plot the spectra obtained with different
<a class="wikilink codevar-link" href="../../variables/gw#ecuteps">ecuteps</a> using</p>
<div class="codehilite"><pre><span></span>&gt;&gt;&gt; gnuplot
gnuplot&gt;  p &quot;tbs_4o_DS1_EXC_MDF&quot; u 1:3 w l
gnuplot&gt;  p &quot;tbs_4o_DS2_EXC_MDF&quot; u 1:3 w l
gnuplot&gt;  p &quot;tbs_4o_DS3_EXC_MDF&quot; u 1:3 w l
gnuplot&gt;  p &quot;tbs_4o_DS4_EXC_MDF&quot; u 1:3 w l
</pre></div>


<p><img alt="" src="../../documents/lesson_bse/tbs4.png" /></p>
<p>The spectrum is found to converge quickly in <a class="wikilink codevar-link" href="../../variables/gw#ecuteps">ecuteps</a>. The curves obtained
with <a class="wikilink codevar-link" href="../../variables/gw#ecuteps">ecuteps</a>=3 and 4 Ha are almost indistinguishable from each other. Our
final estimate for <a class="wikilink codevar-link" href="../../variables/gw#ecuteps">ecuteps</a> is therefore 3 Ha.</p>
<p>Note that this value is smaller than the one required to converge the QP
corrections within 0.01 eV (in the <a href="../lesson_gw1.html">first lesson</a> of the GW
tutorial we obtained 6.0 Ha). This is a general behavior, in the sense that
Bethe-Salpeter spectra, unlike GW corrections, are not usually very sensitive
to truncations in the planewave expansion of W. Reasonable BS spectra are
obtained even when W is treated within the diagonal approximation or,
alternatively, with model dielectric functions.</p>
<p>Note also how the two peaks are affected in a different way by the change of
<a class="wikilink codevar-link" href="../../variables/gw#ecuteps">ecuteps</a>, with the first peak affected the most. This behavior is
consistent with our affirmation that the first peak of silicon has a strong
excitonic character.</p>
<h2 id="5-convergence-with-respect-to-the-number-of-k-points">5 Convergence with respect to the number of k-points<a class="headerlink" href="#5-convergence-with-respect-to-the-number-of-k-points" title="Permanent link">&para;</a></h2>
<p>The last parameter that should be checked for convergence is the number of
k-points. This convergence study represents the most tedious and difficult
part since it requires the generation of new WFK files and of the new SCR file
for each k-mesh (the list of k-points for the wavefunctions and the set of
q-points in the screening must be consistent with each other).</p>
<p>The file ~abinit/tests/tutorial/Input/tbs_5.in gathers the different steps of
a standard BS calculation (generation of two WFK file, screening calculation,
BS run) into a single input. The calculation is done with the converged
parameters found in the previous studies, only <a class="wikilink codevar-link" href="../../variables/basic#ngkpt">ngkpt</a> has been
intentionally left undefined.</p>
<p>Use tbs_5.in as a template for performing BS calculations with different
k-meshes. For example, you might try to compare the three meshes 4x4x4, 5x5x5,
and 6x6x6. To facilitate the analysis of the results, we suggest to run the
calculations in different directories so that we can keep the output results
separated.</p>
<p>Be aware that both the CPU time as well as the memory requirements increase
quickly with the number of divisions in the mesh. These are, for example, the
CPU times required by different k-meshes on Intel Xeon X5570:</p>
<div class="codehilite"><pre><span></span>4x4x4:    +Overall time at end (sec) : cpu=        112.4  wall=        112.4
5x5x5:    +Overall time at end (sec) : cpu=        362.8  wall=        362.8
6x6x6:    +Overall time at end (sec) : cpu=        914.8  wall=        914.8
8x8x8:    +Overall time at end (sec) : cpu=       5813.3  wall=       5813.3
10x10x10: +Overall time at end (sec) : cpu=      20907.1  wall=      20907.1
12x12x12: +Overall time at end (sec) : cpu=      62738.2  wall=      62738.2
</pre></div>


<p>6x6x6 is likely the most dense sampling you can afford on a single-CPU
machine. For you convenience, we have collected the results of the convergence
test in the figure below.</p>
<p><img alt="" src="../../documents/lesson_bse/tbs5.png" /></p>
<p>As anticipated, the spectrum converges slowly with the number of k-points and
our first calculation done with the 4x4x4 grid is severely unconverged. The
most accurate results are obtained with the 12x12x12 k-mesh, but even this
sampling leads to converged results only for frequencies below 4.5 eV. This is
a problem common to all BS computations, in the sense that it is extremely
difficult to achieve global converge in the spectra. This analysis shows that
we can trust the 12x12x12 results in the [0:4,5] eV range while the correct
description of the spectrum at higher energies would require the inclusion of
more k-point and, possibly, more bands so that the band dispersion is
correctly taken into account (even the RPA spectrum does not coverge at high
frequencies when 12x12x12 is used).</p>
<p>It should be stressed that <a class="wikilink codevar-link" href="../../variables/gw#zcut">zcut</a> plays a very important role in these
converge tests. For example, the results obtained with the 8x8x8 or the
10x10x10 k-mesh can be brought closer to the 12x12x12 by just increasing the
Lorentzian broadening. When comparing theory with experiments, it is common to
treat <a class="wikilink codevar-link" href="../../variables/gw#zcut">zcut</a> as an <em>a posteriori</em> parameter chosen to produce the best
agreement with the experiment.</p>
<h2 id="6-additional-exercises-optional">6 Additional exercises (optional)<a class="headerlink" href="#6-additional-exercises-optional" title="Permanent link">&para;</a></h2>
<ul>
<li>Use <a class="wikilink codevar-link" href="../../variables/bse#bs_coupling">bs_coupling</a>=1 to perform an excitonic calculation for silicon including the coupling term. Compare the imaginary part of the macroscopic dielectric function obtained with and without coupling. Do you find significant differences? (Caveat: calculations with coupling cannot use the Haydock method and are much more CPU demanding. You might have to decrease some input parameters to have results in reasonable time.) </li>
<li>Calculate the one-shot GW corrections for silicon following the <a href="../lesson_gw1.html">first lesson</a> of the GW tutorial. Then use the _GW file produced by the code to calculate the absorption spectrum. </li>
</ul>
<h2 id="7-notes-on-the-mpi-implementation">7 Notes on the MPI implementation<a class="headerlink" href="#7-notes-on-the-mpi-implementation" title="Permanent link">&para;</a></h2>
<p>In this section, we discuss the approach used to parallelize the two steps of
the BS run, <em>i.e.</em> the construction of the H matrix and the evaluation of the
macroscopic dielectric function.</p>
<p>First of all, it is important to stress that, unlike the GW code, the BS
routines do not employ any kind of memory distribution for the wavefunctions.
The entire set of orbitals used to construct the transition space is stored on
each node This choice has been dictated by the fact that the size of H is
usually much larger than the array used to store the wavefunction, hence it is
much more important to distribute the matrix than the wavefunctions. Besides,
having all the states on each node simplifies the calculation of several
intermediate quantities needed at run-time.</p>
<p>The memory allocated for the wavefunctions and the screening thus will not
scale with the number of processors. However, for very memory demanding
calculations, the real space orbitals can be calculated on the fly with an
increase in computational time instead. This option is controlled by the
second digit of the input variable <a class="wikilink codevar-link" href="../../variables/gw#gwmem">gwmem</a>.</p>
<p>When discussing the MPI parallelization of the Bethe-Salpeter routines, we
have to consider the two steps separately.</p>
<p>In the first step, the upper triangle of the resonant (coupling) block is
distributed among the nodes. Each CPU computes its own portion and stores the
results in a temporary array. At the end of the computation, the portions of
the upper triangle are communicated to the master node which writes the binary
file BSR (BSC).</p>
<p>In the second step, each node reads the data stored in the external files in
order to build the excitonic Hamiltonian.  The matrix is distributed using a
column-block partitioning, so that the matrix-vector multiplications required
in the Haydock iterative scheme can be easily performed in parallel (see the
schematic representation reported below). A similar distribution scheme is
also employed for the conjugate-gradient minimization. For a balanced
distribution of computational work, the number of processors should divide the
total number of resonant transitions.</p>
<p><img alt="" src="../../documents/lesson_paral_mbt/MPI_mv.png" /></p>
                
                  
                
              

<!-- 
add dropdown button with toolbar (based on https://bootsnipp.com/snippets/featured/inbox-by-gmail)
and return to Top button (based on https://codepen.io/rdallaire/pen/apoyx)
-->
<div class="md-container">
  <div class="row">
    <div id="inbox">
      <div class="fab btn-group show-on-hover dropup">
        <div data-toggle="tooltip" data-placement="left" title="Menu" style="margin-left: 42px;">
          <button id="return-to-top" type="button" class="btn btn-primary btn-io dropdown-toggle" data-toggle="dropdown">
            <span class="fa-stack fa-2x">
                <i class="fa fa-circle fa-stack-2x fab-backdrop"></i>
                <i class="fa fa-chevron-up fa-stack-1x fa-inverse fab-primary"></i>
                <i class="fa fa-map-signs fa-stack-1x fa-inverse fab-secondary"></i>
            </span>
          </button>
        </div>
        <ul class="dropdown-menu dropdown-menu-right" role="menu">
        
        
          <li><a href="../../about/release-notes/" data-toggle="tooltip" data-placement="left" 
                  title=About><i class="fa fa-info-circle"></i></a></li>
        
          <li><a href="../../developers/abimkdocs/" data-toggle="tooltip" data-placement="left" 
                  title=Developers><i class="fa fa-terminal"></i></a></li>
        
          <li><a href="../../theory/wavefunctions/" data-toggle="tooltip" data-placement="left" 
                  title=Theory><i class="fa fa-book"></i></a></li>
        
          <li><a href="../welcome/" data-toggle="tooltip" data-placement="left" 
                  title=Lessons><i class="fa fa-graduation-cap"></i></a></li>
        
          <li><a href="../../variables/" data-toggle="tooltip" data-placement="left" 
                  title=Variables><i class="fa fa-file-text-o"></i></a></li>
        
          <li><a href="../../topics/" data-toggle="tooltip" data-placement="left" 
                  title=Topics><i class="fa fa-question"></i></a></li>
        
          <li><a href="../.." data-toggle="tooltip" data-placement="left" 
                  title=User Guide><i class="fa fa-user-circle-o"></i></a></li>
        
        <!--
        Example: 
        <li><a href="/index.html" data-toggle="tooltip" data-placement="left" title="User-Guide">
              <i class="fa fa-user-circle-o"></i></a></li>
        -->
        </ul>
      </div>
    </div>
  </div>
</div>

              
                
              
            </article>
          </div>
        </div>
      </main>
      
    <!-- Add tabs to footer -->
    
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="User Guide" class="md-tabs__link">
          User Guide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../topics/" title="Topics" class="md-tabs__link">
          Topics
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../variables/" title="Variables" class="md-tabs__link">
          Variables
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../welcome/" title="Lessons" class="md-tabs__link md-tabs__link--active">
          Lessons
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../theory/wavefunctions/" title="Theory" class="md-tabs__link">
          Theory
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../developers/abimkdocs/" title="Developers" class="md-tabs__link">
          Developers
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../about/release-notes/" title="About" class="md-tabs__link">
          About
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
    
    
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../gw2/" title="GW2" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                GW2
              </span>
            </div>
          </a>
        
        
          <a href="../basepar/" title="Base" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Base
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
            <center>Abinit version 8.5.4</center>
        
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 The Abinit Group (MG, MS)
          </div>
        

        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/abinit/abinit" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/hashtag/abinit" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="http://www.facebook.com/abinit.org" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://www.youtube.com/watch?v=gcbfb_Mteo4" class="md-footer-social__link fa fa-youtube"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      

    </div>
    
      <script src="../../assets/javascripts/application-6940329b9f.js"></script>
      
      
      <script>app.initialize({url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.8/ace.js"></script>
      
        <script src="../../extra_javascript/abidocs.js"></script>
      
    
    
      
    
  </body>
</html>