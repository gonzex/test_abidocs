<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="The Abinit group">
        <link rel="canonical" href="http://www.abinit.org/tutorials/elastic/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Elastic - abinit</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/extra.css" rel="stylesheet">
        <link href="../../css/codehilite.css" rel="stylesheet">
    
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
    <!-- <script src="../../js/somelib.js"></script> -->

    <!--
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    -->

    <!--
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script> $( function() {$( "#abinit-tabs" ).tabs();} ); </script>
    -->

    
 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">abinit</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Quick Start <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../..">Introduction</a>
</li>
                            
<li >
    <a href="../../installation/">Installation</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Topics</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../topics/crystal/">Crystalline Structure</a>
</li>
            
<li >
    <a href="../../topics/kpoints/">K-points</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../user-guide/help_what_ABINIT_does/">Overview</a>
</li>
                            
<li >
    <a href="../../user-guide/help_abinit/">Abinit</a>
</li>
                            
<li >
    <a href="../../user-guide/help_mrgddb/">Mrgddb</a>
</li>
                            
<li >
    <a href="../../user-guide/help_optic/">Optic</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Input Variables <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">Abinit</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../input_variables/varlist_abinit/">All Variables</a>
</li>
            
<li >
    <a href="../../input_variables/varbas/">Basic</a>
</li>
            
<li >
    <a href="../../input_variables/varbse/">Bethe-Salpeter</a>
</li>
            
<li >
    <a href="../../input_variables/vardev/">Developers</a>
</li>
            
<li >
    <a href="../../input_variables/vardmft/">DMFT</a>
</li>
            
<li >
    <a href="../../input_variables/vareph/">Electron-Phonon</a>
</li>
            
<li >
    <a href="../../input_variables/varff/">Varff</a>
</li>
            
<li >
    <a href="../../input_variables/varfil/">File-handling</a>
</li>
            
<li >
    <a href="../../input_variables/vargeo/">Geometry</a>
</li>
            
<li >
    <a href="../../input_variables/vargs/">Ground-State</a>
</li>
            
<li >
    <a href="../../input_variables/vargw/">GW</a>
</li>
            
<li >
    <a href="../../input_variables/varint/">Internal</a>
</li>
            
<li >
    <a href="../../input_variables/varpar/">Parallelism</a>
</li>
            
<li >
    <a href="../../input_variables/varpaw/">PAW</a>
</li>
            
<li >
    <a href="../../input_variables/varrf/">RF</a>
</li>
            
<li >
    <a href="../../input_variables/varrlx/">Relaxation</a>
</li>
            
<li >
    <a href="../../input_variables/varvdw/">VdW</a>
</li>
            
<li >
    <a href="../../input_variables/varw90/">Wannier90</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../welcome/">Overview</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Base Tutorials</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../base1/">Base1</a>
</li>
            
<li >
    <a href="../base2/">Base2</a>
</li>
            
<li >
    <a href="../base3/">Base3</a>
</li>
            
<li >
    <a href="../base4/">Base4</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">DFPT</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../rf1/">RF1</a>
</li>
            
<li >
    <a href="../rf2/">RF2</a>
</li>
            
<li class="active">
    <a href="./">Elastic</a>
</li>
            
<li >
    <a href="../eph/">EPH</a>
</li>
    </ul>
  </li>
                            
<li >
    <a href="../dmft/">DMFT</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Many-Body</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../gw1/">GW1</a>
</li>
            
<li >
    <a href="../gw2/">GW2</a>
</li>
            
<li >
    <a href="../bse/">Bethe-Salpeter</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Parallelism</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../basepar/">Base</a>
</li>
            
<li >
    <a href="../paral_mbt/">Many-Body</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Theory <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../theory/theory_mbt/">MBPT</a>
</li>
                            
<li >
    <a href="../../theory/additional_material/">Additional Material</a>
</li>
                            
<li >
    <a href="../../bibliography/">Bibliography</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../about/release-notes/">Release Notes</a>
</li>
                            
<li >
    <a href="../../about/contributing/">Contributing</a>
</li>
                            
<li >
    <a href="../../about/license/">License</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../rf2/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../eph/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/abinit/abinit/">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#146-the-ground-state-geometry-of-hypothetical-wurtzite-alas">1. The ground-state geometry of (hypothetical) wurtzite AlAs.</a></li>
        <li class="main "><a href="#246-response-function-calculations-of-several-second-derivatives-of-the">**2. Response-function calculations of several second derivatives of the</a></li>
        <li class="main "><a href="#346-anaddb-calculation-of-atom-relaxation-effects">3. anaddb calculation of atom-relaxation effects.</a></li>
        <li class="main "><a href="#446-finite-difference-calculation-of-elastic-and-piezoelectric">**4. Finite-difference calculation of elastic and piezoelectric</a></li>
        <li class="main "><a href="#546-alternative-response-function-calculation-of-some-piezoelectric">**5. Alternative response-function calculation of some piezoelectric</a></li>
        <li class="main "><a href="#646-response-function-calculation-of-the-elastic-constants-of-al">**6. Response-function calculation of the elastic constants of Al</a></li>
        <li class="main "><a href="#comment-on-symmetry">Comment on symmetry</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>This lesson shows how to calculate physical properties related to strain, for
an insulator and a metal :</p>
<ul>
<li>the rigid-atom elastic tensor </li>
<li>the rigid-atom piezoelectric tensor (insulators only) </li>
<li>the internal strain tensor </li>
<li>the atomic relaxation corrections to the elastic and piezoelectric tensor </li>
</ul>
<p>You should complete lessons <a href="../lesson_rf1.html">RF1</a> and <a href="../lesson_rf2.html">RF2</a>
to introduce the response-function features of ABINIT before starting this
lesson. You will learn to use additional response-function features of ABINIT,
and to use relevant parts of the associated codes Mrgddb and Anaddb.</p>
<p>This lesson should take about two hours.</p>
<ul>
<li>1 The ground-state geometry of (hypothetical) wurtzite AlAs.</li>
<li>2 Response-function calculation of several second derivatives of the total energy.</li>
<li>3 anaddb calculation to incorporate atom-relaxation effects.</li>
<li>4 Finite-difference calculation of elastic and piezoelectric constants.</li>
<li>5 Alternative response-function calculation of some piezoelectric constants.</li>
<li>6 Response-function calculation of the elastic constants for Al metal.</li>
</ul>
<hr />
<h3 id="146-the-ground-state-geometry-of-hypothetical-wurtzite-alas"><strong>1. The ground-state geometry of (hypothetical) wurtzite AlAs.</strong><a class="headerlink" href="#146-the-ground-state-geometry-of-hypothetical-wurtzite-alas" title="Permanent link">&para;</a></h3>
<p>_Before beginning, you might consider working in a different subdirectory as
for the other lessons. Why not create &ldquo;Work_elast&rdquo; in
~abinit/tests/tutorespfn/Input ? _  </p>
<p>You should copy the files ~abinit/tests/tutorespfn/Input/telast_1.files and
telast_1.in into Work_elast. You may wish to start the calculation (less than
one minute on a standard 3GHz machine) before you read the following. You
should open your input file telast_1.in with an editor and examine it as you
read this discussion.</p>
<p>The hypothetical wurtzite structure for AlAs retains the tetrahedral
coordination of the atoms of the actual zincblende structure of AlAs, but has
a hexagonal lattice. It was chosen for this lesson because the atomic
positions are not completely determined by symmetry. Both the atomic positions
and the lattice constants should be optimized before beginning response-
function calculations, especially those related to strain properties. While GS
structural optimization was treated in lessons 1-3, we are introducing a few
new features here, and you should look at the following new input variables
which will be discussed below:  </p>
<ul>
<li><a href="../../../input_variables/generated_files/varrlx.html#getxred"> getxred</a></li>
<li><a class="wikilink" href="../../input_variables/varrlx/#iatfix">iatfix</a> </li>
<li><a href="../../../input_variables/generated_files/varrlx.html#natfix"> natfix</a></li>
<li><a href="../../../input_variables/generated_files/varrlx.html#strfact"> strfact</a>   </li>
</ul>
<p>There are two datasets specified in telast_1.in. First, let us examine the
common input data. We specify a starting guess for <a href="../../../input_variables/generated_files/varbas.html#acell">
acell</a> , and give an
accurate decimal specification for <a href="../../../input_variables/generated_files/varbas.html#rprim">
rprim</a> . The
definition of the atom types and atoms follows <a href="../lesson_rf1.html">lesson RF1</a> .
The reduced atomic positions <a href="../../../input_variables/generated_files/varbas.html#xred">
xred</a> are a starting
approximation, and will be replaced by our converged results in the remaining
input files, as will <a href="../../../input_variables/generated_files/varbas.html#acell">
acell</a> .</p>
<p>We will work with a fixed plane wave cutoff <a href="../../../input_variables/generated_files/varbas.html#ecut">
ecut</a> (=6 Ha), but
introduce <a href="../../../input_variables/generated_files/varrlx.html#ecutsm"> ecutsm</a>
(=0.5 Ha)as in <a href="../lesson_base3.html"> lesson 3</a> to smear the cutoff, which
produces smoothly varying stresses as the lattice parameters are optimized. We
will keep the same value of <a href="../../../input_variables/generated_files/varrlx.html#ecutsm">
ecutsm</a> for the
response-function calculations as well, since changing it from the
optimization run value could reintroduce non-zero forces and stresses. For the
k-point grid, we must explicitly specify <a href="../../../input_variables/generated_files/varbas.html#shiftk">
shiftk</a> since the
default value results in a grid shifted so as to break hexagonal symmetry. The
RF strain calculations check this, and will exit with an error message if the
grid does not have the proper symmetry. The self-consistency procedures follow
<a href="../lesson_rf1.html">lesson RF1</a> .</p>
<p>Dataset 1 optimizes the atomic positions keeping the lattice parameters fixed,
setting <a href="../../../input_variables/generated_files/varrlx.html#ionmov"> ionmov</a> =2
as in <a href="../lesson_base1.html">lesson 1</a> . The optimization steps proceed until the
maximum force component on any atom is less than <a href="../../../input_variables/generated_files/varrlx.html#tolmxf">
tolmxf</a> . It is
always advised to relax the forces before beginning the lattice parameter
optimization. Dataset 2 optimizes the lattice parameters with <a href="../../../input_variables/generated_files/varrlx.html#optcell">
optcell</a> =2 as in
<a href="../lesson_base3.html">lesson 3</a> . However, lesson 3 treated cubic Si, and the
atom positions in reduced coordinates remained fixed. In the present, more
general case, the reduced atomic coordinates must be reoptimized as the
lattice parameters are optimized. Note that it is necessary to include <a href="../../../input_variables/generated_files/varrlx.html#getxred">
getxred</a> = -1 so
that the second dataset is initialized with the relaxed coordinates .
Coordinate and lattice parameter optimizations actually take place
simultaneously, with the computed stresses at each step acting as forces on
the lattice parameters. We have introduced <a href="../../../input_variables/generated_files/varrlx.html#strfact">
strfact</a> which
scales the stresses so that they may be compared with the same <a href="../../../input_variables/generated_files/varrlx.html#tolmxf">
tolmxf</a> convergence
test that is applied to the forces. The default value of 100 is probably a
good choice for many systems, but you should be aware of what is happening.</p>
<p>From the hexagonal symmetry, we know that the positions of the atoms in the
a-b basal plane are fixed. However, a uniform translation along the c axis of
all the atoms leaves the structure invariant. Only the relative displacement
of the Al and As planes along the c axis is physically relevant. We will fix
the Al positions to be at reduced c-axis coordinates 0 and 1/2 (these are
related by symmetry) by introducing <a href="../../../input_variables/generated_files/varrlx.html#natfix">
natfix</a> and <a href="../../../input_variables/generated_files/varrlx.html#iatfix">
iatfix</a> to constrain
the structural optimization. This is really just for cosmetic purposes, since
letting them all slide an arbitrary amount (as they otherwise would) won&rsquo;t
change any results. However, you probably wouldn&rsquo;t want to publish the results
that way, so we may as well develop good habits.  </p>
<p>Now we shall examine the results of the structural optimization run. As
always, we should first examine the log file to make sure the run has
terminated cleanly. There are a number of warnings, but none of them are
apparently serious. Next, let us edit the output file, telast_1.out. The first
thing to look for is to see whether Abinit recognized the symmetry of the
system. In setting up a new data file, it&rsquo;s easy to make mistakes, so this is
a valuable check. We see</p>
<div class="codehilite"><pre><span></span>DATASET    1 : space group P6_3 m c (#186); Bravais hP (primitive hexag.)
</pre></div>


<p>which is correct. Next, we confirm that the structural optimization converged.
The following lines from dataset 1 and dataset2 tell us that things are OK:</p>
<div class="codehilite"><pre><span></span>At Broyd/MD step   4, gradients are converged :
 max grad (force/stress) = 1.0670E-08 &lt; tolmxf= 1.0000E-06 ha/bohr (free atoms)

At Broyd/MD step  11, gradients are converged :
 max grad (force/stress) = 7.8147E-08 &lt; tolmxf= 1.0000E-06 ha/bohr (free atoms)
</pre></div>


<p>We can also confirm that the stresses are relaxed:</p>
<div class="codehilite"><pre><span></span>Cartesian components of stress tensor (hartree/bohr^3)
 sigma(1 1)= -3.76811543E-10  sigma(3 2)=  0.00000000E+00
 sigma(2 2)= -3.76811542E-10  sigma(3 1)=  0.00000000E+00
 sigma(3 3)=  7.81471561E-10  sigma(2 1)=  0.00000000E+00
</pre></div>


<p>Now would be a good time to copy telast_2.in and telast_2.files into your
working directory, since we will use the present output to start the next run.
Locate the optimized lattice parameters and reduced atomic coordinates near
the end of telast_1.out:</p>
<div class="codehilite"><pre><span></span>     acell2   7.5389647789E+00  7.5389647789E+00  1.2277795511E+01 Bohr

      xred2   3.3333333333E-01  6.6666666667E-01  0.0000000000E+00
              6.6666666667E-01  3.3333333333E-01  5.0000000000E-01
              3.3333333333E-01  6.6666666667E-01  3.7608587611E-01
              6.6666666667E-01  3.3333333333E-01  8.7608587611E-01
</pre></div>


<p>With your editor, copy and paste these into telast_2.in at the indicated
places in the &ldquo;Common input data&rdquo; area. Be sure to change acell2 and xred2 to
acell and xred since these common values will apply to all datasets in the
next set of calculations.  </p>
<hr />
<h3 id="246-response-function-calculations-of-several-second-derivatives-of-the">**2. Response-function calculations of several second derivatives of the<a class="headerlink" href="#246-response-function-calculations-of-several-second-derivatives-of-the" title="Permanent link">&para;</a></h3>
<p>total energy.**</p>
<p>We will now compute second derivatives of the total energy (2DTE&rsquo;s) with
respect to all the perturbations we need to compute elastic and piezoelectric
properties. You may want to review <a href="../../../users/generated_files/help_respfn.html#0"> sections 0 and the first paragraph of
section 1</a> of the respfn_help
file which you studied in lesson RF1. We will introduce only one new input
variable for the strain perturbation,</p>
<ul>
<li><a class="wikilink" href="../../input_variables/varrf/#rfstrs">rfstrs</a>   </li>
</ul>
<p>The treatment of strain as a perturbation has some subtle aspects. It would be
a good idea to read  Metric tensor formulation of strain in density-functional
perturbation theory, by D. R. Hamann, Xifan Wu, Karin M. Rabe, and David
Vanderbilt, <a href="http://dx.doi.org/10.1103/PhysRevB.71.035117">Phys. Rev. B 71, 035117
(2005)</a> , especially Sec. II and
Sec. IV. We will do all the RF calculations you learned in lesson RF1 together
with strain, so you should review the variables</p>
<ul>
<li><a href="../../../input_variables/generated_files/varrf.html#rfphon"> rfphon</a></li>
<li><a href="../../../input_variables/generated_files/varrf.html#rfatpol"> rfatpol</a></li>
<li><a href="../../../input_variables/generated_files/varrf.html#rfdir"> rfdir</a></li>
<li><a class="wikilink" href="../../input_variables/varrf/#rfelfd">rfelfd</a>   </li>
</ul>
<p>It would be a good idea to copy telast_2.files into Work_elast and start the
calculation while you read (less than 2 minutes on a standard 3GHz machine).
Look at telast_2.in in your editor to follow the discussion, and double check
that you have copied acell and xred as discussed in the last section.</p>
<p>This has been set up as a self-contained calculation with three datasets. The
first is simply a GS run to obtain the GS wave functions we will need for the
response function (RF) calculations. We have removed the convergence test from
the common input data to remind ourselves that different tests are needed for
different datasets. We set a tight limit on the convergence of the self-
consistent potential with <a href="../../../input_variables/generated_files/varbas.html#tolvrs">
tolvrs</a> . Since we
have specified <a href="../../../input_variables/generated_files/varbas.html#nband">
nband</a> =8, all the
bands are occupied and the potential test also assures us that all the wave
functions are well converged. This issue will come up again in section 6 . We
could have used the output wave functions telast_1o_DS2_WFK as input for our
RF calculations and skipped dataset 1, but redoing the GS calculation takes
relatively little time for this simple system .</p>
<p>Dataset 2 involves the calculation of the derivatives of the wave functions
with respect to the Brillouin-zone wave vector, the so-called ddk wave
functions. Recall that these are auxiliary quantities needed to compute the
response to the<a href="../lesson_rf1.html#5"> electric field perturbation</a> and
introduced in lesson RF1 . It would be a good idea to review the relevant
parts of <a href="../../../users/generated_files/help_respfn.html#1"> section 1</a> of the
respfn_help file. Examining this section of telast_2.in, note that electric
field as well as strain are uniform perturbations, only are defined for <a href="../../../input_variables/generated_files/vargs.html#qpt">
qpt</a> = 0 0 0. <a href="../../../input_variables/generated_files/varrf.html#rfelfd">
rfelfd</a> = 2 specifies
that we want the ddk calculation to be performed, which requires <a href="../../../input_variables/generated_files/varbas.html#iscf">
iscf</a> = -3. The ddk
wave functions will be used to calculate both the piezoelectric tensor and the
Born effective charges, and in general we need them for <strong> k</strong> derivatives in
all three (reduced) directions, <a href="../../../input_variables/generated_files/varrf.html#rfdir">
rfdir</a> = 1 1 1. Since
there is no potential self-consistency in the ddk calculations, we must
specify convergence in terms of the wave function residuals using <a href="../../../input_variables/generated_files/varbas.html#tolwfr">
tolwfr</a> .  </p>
<p>Finally, dataset 3 performs the actual calculations of the needed 2DTE&rsquo;s for
the elastic and piezoelectric tensors. Setting <a href="../../../input_variables/generated_files/varrf.html#rfphon">
rfphon</a> = 1 turns on
the atomic displacement perturbation, which we need for all atoms (<a href="../../../input_variables/generated_files/varrf.html#rfatpol">
rfatpol</a> = 1 4) and
all directions (<a href="../../../input_variables/generated_files/varrf.html#rfdir">
rfdir</a> = 1 1 1).
Abinit will calculate first-order wave functions for each atom and direction
in turn, and use those to calculate 2DTE&rsquo;s with respect to all pairs of atomic
displacements and with respect to one atomic displacement and one component of
electric field. These quantities, the interatomic force constants (at gamma)
and the Born effective charges will be used later to compute the atomic
relaxation contribution to the elastic and piezoelectric tensor.</p>
<p>First-order wave functions for the strain perturbation are computed next.
Setting <a class="wikilink" href="../../input_variables/varrf/#rfstrs">rfstrs</a> = 3 specifies that we want both uniaxial and shear strains
to be treated, and <a href="../../../input_variables/generated_files/varrf.html#rfdir">
rfdir</a> = 1 1 1 cycles
through strains xx, yy, and zz for uniaxial and yz, xz, and xy for shear. We
note that while other perturbations in Abinit are treated in reduced
coordinates, strain is better dealt with in Cartesian coordinates for reasons
discussed in the reference cited above. These wave functions are used to
compute three types of 2DTE&rsquo;s. Derivatives with respect to two strain
components give us the so-called rigid-ion elastic tensor. Derivatives with
respect to one strain and one electric field component give us the rigid-ion
piezoelectric tensor. Finally, derivatives with respect to one strain and one
atomic displacement yield the internal-strain force-response tensor, an
intermediate quantity that will be necessary to compute the atomic relaxation
corrections to the rigid-ion quantities. As in lesson RF1, we specify
convergence in terms of the residual of the potential (here the first-order
potential) using <a href="../../../input_variables/generated_files/varbas.html#tolvrs">
tolvrs</a> .</p>
<p>Your run should have completed by now. Abinit should have created quite a few
files.</p>
<ul>
<li>telast_2.log (log file)</li>
<li>telast_2.out (main output file)</li>
<li>telast_2o_DS1_DDB (first derivatives of the energy from GS calculation)</li>
<li>telast_2o_DS3_DDB (second derivatives from the RF calculation)</li>
<li>telast_2o_DS1_WFK (GS wave functions)</li>
<li>telast_2o_DS2_1WF* (ddk wave functions)</li>
<li>telast_2o_DS3_1WF* (RF first-order wave functions from various perturbations)</li>
</ul>
<p>The log and out files are diagnostics and readable output information for a
wide variety of properties. The derivative database DDB files are ascii and
readable, but primarily for subsequent analysis by anaddb which we will
undertake in the next section. Finally, the various wave function binary files
are primarily of use for subsequent calculations, where they could cut the
number of needed iterations in, for example, convergence testing. We take note
of a few conventions in the file names. The root output file name telast_2o is
from the 4th line of the &ldquo;files&rdquo; file. The dataset producing the file is next.
Finally, the first-order wave function 1WF files have a final &ldquo;pertcase&rdquo;
number described in <a href="../../../users/generated_files/help_respfn.html#1"> section
1</a> of the respfn_help file.
While telast_2.in specifies all atomic displacements, only the symmetry-
inequivalent perturbations are treated, so the &ldquo;pertcase&rdquo; list is incomplete.
All cases specified in the input data are treated for the strain perturbation.  </p>
<p>First, take a look at the end of the telast_2.log file to make sure the run
has completed without error. You might wish to take a look at the WARNING&rsquo;s,
but they all appear to be harmless. Next, edit your telast_2.out file.
Searching backwards for ETOT you will find</p>
<div class="codehilite"><pre><span></span>     iter   2DEtotal(Ha)       deltaE(Ha) residm    vres2
-ETOT  1   2.3955208361366     -6.519E+00 6.313E-01 4.126E+02
 ETOT  2   1.3040286462220     -1.091E+00 4.926E-04 4.735E+00
 ETOT  3   1.2898966738702     -1.413E-02 1.857E-05 3.504E-01
 ETOT  4   1.2891923712805     -7.043E-04 2.937E-07 8.931E-03
 ETOT  5   1.2891781500347     -1.422E-05 7.582E-09 5.989E-05
 ETOT  6   1.2891780804502     -6.958E-08 4.440E-11 7.674E-07
 ETOT  7   1.2891780792714     -1.179E-09 1.236E-12 2.972E-08
 ETOT  8   1.2891780791847     -8.667E-11 2.674E-14 7.671E-10
 ETOT  9   1.2891780791827     -2.006E-12 9.086E-16 4.128E-12

 At SCF step    9       vres2   =  4.13E-12 &lt; tolvrs=  1.00E-10 =&gt;converged.
</pre></div>


<p>Abinit is solving a set of Schroedinger-like equations for the first-order
wave functions, and these functions minimize a variational expression for the
2DTE.  (Technically, they are called self-consistent Sternheimer equations.)
The  energy  convergence looks similar to that of GS calculations.  The fact
that vres2, the residual of the self-consistent first-order potential, has
reached <a href="../../../input_variables/generated_files/varbas.html#tolvrs"> tolvrs</a>
well within <a class="wikilink" href="../../input_variables/varbas/#nstep">nstep</a> (40) iterations indicates that the 2DTE calculation for
this perturbation (xy strain) has converged . It would pay to examine a few
more cases for different perturbations (unless you have looked through all the
warnings in the log).</p>
<p>Another convergence item to examine in your .out file is</p>
<div class="codehilite"><pre><span></span> Seventeen components of 2nd-order total energy (hartree) are
 1,2,3: 0th-order hamiltonian combined with 1st-order wavefunctions
     kin0=   9.10477366E+00 eigvalue=   3.11026184E-01  local=  -3.66858410E+00
 4,5,6,7: 1st-order hamiltonian combined with 1st and 0th-order wfs
 loc psp =  -8.91644855E+00  Hartree=   4.33575581E+00     xc=  -6.58530138E-01
     kin1=  -8.62111363E+00
 8,9,10: eventually, occupation + non-local contributions
    edocc=   0.00000000E+00     enl0=   6.43290228E-01   enl1=  -1.55388963E-01
 1-10 gives the relaxation energy (to be shifted if some occ is /=2.0)
   erelax=  -7.62521951E+00
 11,12,13 Non-relaxation  contributions : frozen-wavefunctions and Ewald
  fr.hart=  -1.18530360E-01   fr.kin=   5.20015318E+00 fr.loc=   4.18792202E-01
 14,15,16 Non-relaxation  contributions : frozen-wavefunctions and Ewald
  fr.nonl=   2.94970622E-01    fr.xc=   9.41457939E-02  Ewald=   3.02486615E+00
 17 Non-relaxation  contributions : pseudopotential core energy
  pspcore=   0.00000000E+00
 Resulting in :
 2DEtotal=    0.1289178079E+01 Ha. Also 2DEtotal=    0.350803195765E+02 eV
    (2DErelax=   -7.6252195073E+00 Ha. 2DEnonrelax=    8.9143975865E+00 Ha)
    (  non-var. 2DEtotal :    1.2891781360E+00 Ha)
</pre></div>


<p>This detailed breakdown of the contributions to 2DTE is probably of limited
interest, but you should compare &ldquo;2DEtotal&rdquo; and &ldquo;non-var. 2DEtotal&rdquo; from the
last three lines. While the first-order wave function for the present
perturbation minimizes a variational  expression for the second derivative
with respect to this perturbation as we just saw, the various 2DTE given as
elastic tensors, etc. in the output and in the DDB file are all computed using
non-variational expressions.  Using the non-variational expressions, mixed
second derivatives with respect to the present perturbation and all other
perturbations of interest can be computed directly from the present first-
order wave functions.   The disadvantage is that the non-variational result
has errors which are linearly proportional to convergence errors in the GS and
first-order wave functions.  Since errors in the variational 2DEtotal are
second-order in wave-function convergence errors, comparing this to the non-
variational result for the diagonal second derivative will give an idea of the
accuracy of the latter and perhaps indicate the need for tighter convergence
tolerances for both the GS and RF wave functions.  This is discussed in  X.
Gonze and C. Lee, Phys. Rev. B 55, 10355 (1997) , Sec. II.  For an atomic-
displacement perturbation, the corresponding breakdown of the 2DTE is headed
&ldquo;Thirteen components.&rdquo;</p>
<p>Now let us take a look at the results we want, the various 2DTE&rsquo;s. They begin</p>
<div class="codehilite"><pre><span></span> ==&gt; Compute Derivative Database &lt;==

  2nd-order matrix (non-cartesian coordinates, masses not included,
   asr not included )
  cartesian coordinates for strain terms (1/ucvol factor
   for elastic tensor components not included)
     j1       j2             matrix element
  dir pert dir pert     real part     imaginary part

   1    1   1    1         5.4508668454         0.0000000000
   1    1   2    1        -2.7254334227         0.0000000000
   1    1   3    1         0.0000000000         0.0000000000
            .....
</pre></div>


<p>These are the &ldquo;raw&rdquo; 2DTE&rsquo;s, in reduced coordinates for atom-displacement and
electric-field perturbations, but Cartesian coordinates for strain
perturbations. This same results with the same organization appear in the file
telast_2_DS3_DDB which will be used later as input for automated analysis and
converted to more useful notation and units by anaddb. A breakout of various
types of 2DTE&rsquo;s follows (all converted to Cartesian coordinates and in atomic
units):  </p>
<div class="codehilite"><pre><span></span>  Dynamical matrix, in cartesian coordinates,
    if specified in the inputs, asr has been imposed
     j1       j2                   matrix element
  dir pert dir pert          real part        imaginary part

   1    1   1    1         0.0959051967         0.0000000000
   1    1   2    1         0.0000000000         0.0000000000
   1    1   3    1         0.0000000000         0.0000000000
            .....
</pre></div>


<p>This contains the interatomic force constant data that will be used later to
include atomic relaxation effects.  &ldquo;asr&rdquo; refers to the acoustic sum rule,
which basically is a way of making sure that forces sum to zero when an atom
is displaced.</p>
<div class="codehilite"><pre><span></span>  Effective charges, in cartesian coordinates,
    (from phonon response)
    if specified in the inputs, asr has been imposed
     j1       j2                   matrix element
  dir pert dir pert          real part        imaginary part

   1    6   1    1         1.8290469443         0.0000000000
   2    6   1    1         0.0000000000         0.0000000000
   3    6   1    1         0.0000000000         0.0000000000
            .....
</pre></div>


<p>The Born effective charges will be used to find the atomic relaxation
contributions of the piezoelectric tensor.</p>
<div class="codehilite"><pre><span></span>  Rigid-atom elastic tensor , in cartesian coordinates,
     j1       j2                   matrix element
  dir pert dir pert          real part        imaginary part

   1    7   1    7         0.0056418385         0.0000000000
   1    7   2    7         0.0013753710         0.0000000000
   1    7   3    7         0.0007168444         0.0000000000
            .....
</pre></div>


<p>The rigid-atom elastic tensor is the 2DTE with respect to a pair of strains.
We recall that &ldquo;pert&rdquo; = natom+3 and natom+4 for unaxial and shear strains,
respectively.</p>
<div class="codehilite"><pre><span></span>  Internal strain coupling parameters, in cartesian coordinates,
    zero average net force deriv. has been imposed
     j1       j2                   matrix element
  dir pert dir pert          real part        imaginary part

   1    1   1    7         0.1249319229         0.0000000000
   1    1   2    7        -0.1249319273         0.0000000000
   1    1   3    7         0.0000000000         0.0000000000
            .....
</pre></div>


<p>These 2DTE&rsquo;s with respect to one strain and one atomic displacement are needed
for atomic relaxation corrections to both the elastic tensor and piezoelectric
tensor. While this set of parameters is of limited direct interest, it should
be examined in cases when you think that high symmetry may eliminate the need
for these corrections. You are probably wrong, and any non-zero term indicates
a correction.</p>
<div class="codehilite"><pre><span></span>  Rigid-atom proper piezoelectric tensor, in cartesian coordinates,
     j1       j2                   matrix element
  dir pert dir pert          real part        imaginary part

   1    1   1    7         0.1249319273         0.0000000000

   1    1   2    7        -0.1249319211         0.0000000000

   1    1   3    7         0.0000000000         0.0000000000
</pre></div>


<p>Finally, we have the piezoelectric tensor, the 2DTE with respect to one strain
and one uniform electric field component.  (Yes, there are non-zero elements.)  </p>
<hr />
<h3 id="346-anaddb-calculation-of-atom-relaxation-effects"><strong>3. anaddb calculation of atom-relaxation effects.</strong><a class="headerlink" href="#346-anaddb-calculation-of-atom-relaxation-effects" title="Permanent link">&para;</a></h3>
<p>In this section, we will run the program anaddb, which analyzes DDB files
generated in prior RF calculations. You should copy telast_3.in and
telast_3.files in your Work_elast directory. You should now go to the <a href="../../../users/generated_files/help_anaddb.html"> anaddb
help file</a> , and read the short
introduction. The bulk of the material in this help file is contained in the
description of the variables. You should read the descriptions of  </p>
<ul>
<li><a href="../../../users/generated_files/help_anaddb.html#elaflag">elaflag</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#piezoflag">piezoflag</a></li>
<li>
<p><a href="../../../users/generated_files/help_anaddb.html#instrflag">instrflag</a>   </p>
</li>
<li>
<p><a href="../../../users/generated_files/help_anaddb.html#chneut">chneut</a></p>
</li>
</ul>
<p>For the theory underlying the incorporation of atom-relaxation corrections, it
is recommended you see  X. Wu, D. Vanderbilt, and D. R. Hamann, <a href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.72.035105">Phys. Rev, B
72, 035105
(2005)</a> .  </p>
<p>Anaddb can do lots of other things, such as calculate the frequency-dependent
dielectric tensor, interpolate the phonon spectrum to make nice phonon
dispersion plots, calculate Raman spectra, etc., but we are focusing on the
minimum needed for the elastic and piezoelectric constants at zero electric
field.  </p>
<p>We also mention that <a href="../../../users/generated_files/help_mrgddb.html"> mrgddb</a>
is another utility program that can be used to combine DDB files generated in
several different datasets or in different runs into a single DDB file that
can be analyzed by anaddb. One particular usage would be to combine the DDB
file produced by the GS run, which contains first-derivative information such
as stresses and forces with the RF DDB. It is anticipated that anaddb in a
future release will implement the finite-stress corrections to the elastic
tensor discussed in <a href="../../../theory/documents/elasticity-oganov.pdf"> notes by A. R.
Oganov</a> .  </p>
<p>Now would be a good time to edit telast_3.in and observe that it is very
simple, consisting of nothing more than the four variables listed above set to
appropriate values. The telast_3.files file is used with anaddb in the same
manner as the abinit .files you are by now used to. The first two lines
specify the .in and .out files, the third line specifies the DDB file, and the
last two lines are dummy names which would be used in connection with other
capabilities of anaddb. Now you should run the calculation, which is done in
the same way as you are now used to for abinit:  </p>
<p>../../anaddb &lt;telast_3.files &gt;&amp;telast_3.log  </p>
<p>This calculation should only take a few seconds. You should edit the log file,
go to the end, and make sure the calculation terminated without error. Next,
examine telast_3.out. After some header information, we come to tables giving
the &ldquo;force-response&rdquo; and &ldquo;displacement-response&rdquo; internal strain tensors.
These represent, respectively, the force on each atom and the displacement of
each atom in response to a unit strain of the specified type. These numbers
are of limited interest to us, but represent important intermediate quantities
in the treatment of atomic relaxation (see the X. Wu paper cited above).  </p>
<p>Next, we come to the elastic tensor output:  </p>
<div class="codehilite"><pre><span></span> Elastic Tensor(clamped ion)(unit:10^2GP):

   1.6598859   0.4046480   0.2109029   0.0000000   0.0000000   0.0000000
   0.4046480   1.6598859   0.2109029   0.0000000  -0.0000000   0.0000000
   0.2109030   0.2109030   1.8258575   0.0000000  -0.0000000   0.0000000
  -0.0000000  -0.0000000  -0.0000000   0.4081820  -0.0000000   0.0000000
   0.0000000   0.0000000   0.0000000  -0.0000000   0.4081820  -0.0000000
  -0.0000000  -0.0000000  -0.0000000   0.0000000  -0.0000000   0.6276190

 Elastic Tensor(relaxed ion)(unit:10^2GP):
   (at fixed electric field boundary condition)

   1.3526217   0.5445039   0.3805291  -0.0000000   0.0000000   0.0000000
   0.5445039   1.3526217   0.3805292   0.0000000  -0.0000000   0.0000000
   0.3805292   0.3805293   1.4821104   0.0000000  -0.0000000   0.0000000
  -0.0000000   0.0000000   0.0000000   0.3055071  -0.0000000   0.0000000
   0.0000000  -0.0000000  -0.0000000  -0.0000000   0.3055071   0.0000000
  -0.0000000   0.0000000  -0.0000000   0.0000000   0.0000000   0.4040588
</pre></div>


<p>While not labeled, the rows and columns 1-6 here represent xx, yy, zz, yz, xz,
xy strains and stresses in the conventional Voigt notation.<br />
The clamped-ion results were calculated in the telast_2 RF run, and are simply
converted to standard GPa units by anaddb (the terms &ldquo;clamped ion,&rdquo; &ldquo;clamped
atom,&rdquo; and &ldquo;rigid atom&rdquo; used in various places are interchangeable, similarly
for &ldquo;relaxed.&rdquo;)<br />
The relaxed-ion result was calculated by anaddb by combining 2DTE&rsquo;s for
internal strain and interatomic force constants which are stored in the input
DDB file. Comparing the clamped and relaxed results, we see that all the
diagonal elastic constants have decreased in value.<br />
This is plausible, since allowing the internal degrees of freedom to relax
should make a material less stiff. These tensors should be symmetric, and
certain tensor elements should be zero or identical by symmetry.<br />
It&rsquo;s a good idea to check these properties against a standard text such as  J.
F. Nye, Physical Properties of Crystals (Oxford U. P., Oxford 1985).
Departures from expected symmetries (there are a few in the last decimal place
here) are due to either convergence errors or, if large, incorrectly specified
geometry (however, see the final comments on symmetry  below).  </p>
<p>Next in telast_3.out we find the piezoelectric tensor results:  </p>
<div class="codehilite"><pre><span></span> Proper piezoelectric constants(clamped ion)(unit:c/m^2)

      0.00000000      0.00000000      0.38490079
      0.00000000      0.00000000      0.38490075
      0.00000000      0.00000000     -0.73943025
      0.00000000      0.43548797      0.00000000
      0.43548796      0.00000000     -0.00000000&lt;
      0.00000000      0.00000000      0.00000001

 Proper piezoelectric constants(relaxed ion)(unit:c/m^2)

      0.00000000     -0.00000000     -0.01187149
     -0.00000000      0.00000000     -0.01187169
     -0.00000000      0.00000000      0.06462779
     -0.00000000     -0.04828847     -0.00000000
     -0.04828832     -0.00000000      0.00000000
</pre></div>


<p>The 3 columns here represent x, y, and z electric polarization, and the 6 rows
the Voigt strains. The clamped-ion result was calculated in the telast_2 RF
run, and is simply scaled to conventional units by anaddb. The ion relaxation
contributions are based on 2DTE&rsquo;s for internal strain, interatomic force
constants, and Born effective charges, and typically constitute much larger
corrections to the piezoelectric tensor than to the elastic tensor. Once
again, symmetries should be checked. (The slight discrepancies seen here can
be removed by setting tolvrs3=1.0d-18 in telast_2.in.) One should be aware
that the piezoelectric tensor is identically zero in any material which has a
center of symmetry.  </p>
<p>Since we are dealing with a hypothetical material, there is no experimental
data with which to compare our results. In the next section, we will calculate
a few of these numbers by a finite-difference method to gain confidence in the
RF approach.  </p>
<hr />
<h3 id="446-finite-difference-calculation-of-elastic-and-piezoelectric">**4. Finite-difference calculation of elastic and piezoelectric<a class="headerlink" href="#446-finite-difference-calculation-of-elastic-and-piezoelectric" title="Permanent link">&para;</a></h3>
<p>constants.**</p>
<p>You should copy telast_4.in and telast_4.files into your Work_elast directory.
Editing telast_4.in, you will see that it has four datasets, the first two
with the c-axis contracted 0.01% and the second two with it expanded 0.01%,
which we specified by changing the third row of <a href="../../../input_variables/generated_files/varbas.html#rprim">
rprim</a> . The common
data is essentially the same as telast_2.in, and the relaxed <a href="../../../input_variables/generated_files/varbas.html#acell">
acell</a> values and <a href="../../../input_variables/generated_files/varbas.html#xred">
xred</a> from
telast_1.out have already been included. Datasets 1 and 3 do the self-
consistent convergence of the GS wave functions for the strained lattices and
compute the stress. Datasets 2 and 4 introduce a new variable.  </p>
<ul>
<li><a class="wikilink" href="../../input_variables/varff/#berryopt">berryopt</a> </li>
</ul>
<p>Electric polarization in solids is a subtle topic which has only recently been
rigorously resolved. It is now understood to be a bulk property, and to be
quantitatively described by a Berry phase formulation introduced by R. D.
King-Smith and D. Vanderbilt, Phys. Ref. B 47, 1651(1993) . It can be
calculated in a GS calculation by integrating the gradient with respect to
<strong>k</strong> of the GS wave functions over the Brillouin zone. In GS calculations,
the gradients are approximated by finite-difference expressions constructed
from neighboring points in the <strong>k</strong> mesh. These are closely related to the
ddk wave functions used in RF calculations in  2 and introduced in <a href="../lesson_rf1.html#5"> lesson
RF1, section 5</a> . We will use <a href="../../../input_variables/generated_files/varff.html#berryopt">
berryopt</a> = -1,
which utilizes an improved coding of the calculation, and must specify
<a class="wikilink" href="../../input_variables/varrf/#rfdir">rfdir</a> = 1 1 1 so that the Cartesian components of the polarization are
computed.  </p>
<p>Now, run the telast_4 calculation, which should only take a minute or two, and
edit telast_4.out. To calculate the elastic constants, we need to find the
stresses  sigma(1 1) and sigma(3 3) . We see that each of the four datasets
have stress results, but that there are slight differences between those from,
for example dataset 1 and dataset 2, which should be identical. Despite our
tight limit, this is still a convergence issue. Look at the following
convergence results,  </p>
<div class="codehilite"><pre><span></span>Dataset 1:
 At SCF step   13       vres2   =  6.24E-21 &lt; tolvrs=  1.00E-18 =&gt;converged.

Dataset 2:
 At SCF step    1       vres2   =  5.08E-21 &lt; tolvrs=  1.00E-18 =&gt;converged.
</pre></div>


<p>Since dataset 2 has better convergence, we will use this and the dataset 4
results, choosing those in GPa units,</p>
<div class="codehilite"><pre><span></span>- sigma(1 1)= -2.11918835E-03  sigma(3 2)=  0.00000000E+00
- sigma(3 3)= -1.82392050E-02  sigma(2 1)=  0.00000000E+00

- sigma(1 1)=  2.09886408E-03  sigma(3 2)=  0.00000000E+00
- sigma(3 3)=  1.82778679E-02  sigma(2 1)=  0.00000000E+00
</pre></div>


<p>Let us now compute the numerical derivative of  sigma(3 3)and compare to our
RF result. Recalling that our dimensionless strains were ±0.0001, we find
182.5853 GPa. This compares very well with the value  182.58575 GPa, the 3,3
element of the Rigid-ion elastic tensor we found from our anaddb calculation
in  3 . (Recall that our strain and stress were both 3 3 or z z or Voigt 3.)
Similarly, the numerical derivative of  sigma(1 1)is 21.09026 GPa, compared to
21.09029 GPa, the 3,1 elastic-tensor element.</p>
<p>The good agreement we found from this simple numerical differentiation
required that we had accurately relaxed the lattice so that the stress of the
unstrained structure was very small. Similar numerical-derivative comparisons
for systems with finite stress are more complicated, as discussed in <a href="../../../theory/documents/elasticity-oganov.pdf"> notes
by A. R. Oganov</a> . Numerical-
derivative comparisons for the relaxed-ion results are extremely challenging
since they require relaxing atomic forces to exceedingly small limits.</p>
<p>Now let us examine the electric polarizations found in datasets 2 and 4,
focusing on the C/m^2 results,</p>
<div class="codehilite"><pre><span></span>           Polarization    -1.578272218E-11 C/m^2
           Polarization     1.578207434E-11 C/m^2
           Polarization    -2.979936062E-01 C/m^2

           Polarization    -1.577757536E-11 C/m^2
           Polarization     1.577753205E-11 C/m^2
           Polarization    -2.981427239E-01 C/m^2
</pre></div>


<p>While not labeled as such, these are the Cartesian x, y, and z components,
respectively, and the x and y components are zero within numerical accuracy as
they must be from symmetry. Numerical differentiation of the z component
yields -0.745589 C/m^2. This is to be compared with the z,3 element of our
rigid-ion piezoelectric tensor from 3, -0.73943025 C/m^2, and the two results
do not compare as well as we might wish.</p>
<p>What is wrong? There are two possibilities. The first is that the RF
calculation produces the proper piezoelectric tensor, while numerical
differentiation of the polarization produces the improper piezoelectric
tensor. This is a subtle point, for which you are referred to  D. Vanderbilt,
J. Phys. Chem. Solids 61, 147 (2000) . The improper-to-proper transformation
only effects certain tensor elements, however, and for our particular
combination of crystal symmetry and choice of strain there is no correction.
The second possibility is the subject of the next section.</p>
<hr />
<h3 id="546-alternative-response-function-calculation-of-some-piezoelectric">**5. Alternative response-function calculation of some piezoelectric<a class="headerlink" href="#546-alternative-response-function-calculation-of-some-piezoelectric" title="Permanent link">&para;</a></h3>
<p>constants.**</p>
<p>Our GS calculation of the polarization in 4 used, in effect, a finite-
difference approximation to ddk wave functions, while our RF calculations in
2 used analytic results based on the RF approach. Since the <strong> k</strong> grid
determined by <a href="../../../input_variables/generated_files/varbas.html#ngkpt">
ngkpt</a> = 4 4 4 and <a href="../../../input_variables/generated_files/varbas.html#nshiftk">
nshiftk</a> = 1 is
rather coarse, this is a probable source of discrepancy. Since this issue was
noted previously in connection with the calculation of Born effective charges
by Na Sai, K. M. Rabe, and D. Vanderbilt, Phys. Rev. B 66, 104108 (2002) ,
Abinit has incorporated the ability to use finite-difference ddk wave
functions from GS calculations in RF calculations of electric-field-related
2DTE&rsquo;s. Copy telast_5.in and telast_5.files into Work_elast, and edit
telast_5.in.</p>
<p>You should compare this with our previous RF data, telast_2.in, and note that
dataset1 and the Common data (after entering relaxed structural results) are
essentially identical. Dataset 2 has been replaced by a non-self-consistent GS
calculation with <a href="../../../input_variables/generated_files/varff.html#berryopt">
berryopt</a> = -2
specified to perform the finite-difference ddk wave function calculation. (The
finite-difference first-order wave functions are implicit but not actually
calculated in the GS polarization calculation.) We have restricted <a href="../../../input_variables/generated_files/varrf.html#rfdir">
rfdir</a> to 0 0 1 since
we are only interested in the 3,3 piezoelectric constant. Now compare dataset
3 with that in telast_2.in. Can you figure out what we have dropped and why?
Run the telast_5 calculation, which will only take about a minute with our
simplifications.</p>
<p>Now edit telast_5.out, looking for the piezoelectric tensor,</p>
<div class="codehilite"><pre><span></span>  Rigid-atom proper piezoelectric tensor, in cartesian coordinates,
     j1       j2                   matrix element
  dir pert dir pert          real part        imaginary part

   3    6   3    7        -0.0130314050         0.0000000000
</pre></div>


<p>We immediately see a problem &ndash; this output, like most of the .out file, is in
atomic units, while we computed our numerical derivative in conventional C/m^2
units. While you might think to simply run anaddb to do the conversion as
before, its present version is not happy with such an incomplete DDB file as
telast_5 has generated and will not produce the desired result. While it
should be left as an exercise to the student to dig the conversion factor out
of the literature, or better yet out of the source code, we will cheat and
tell you that 1a.u.=57.2147606 C/m^2 Thus the new RF result for the 3,3 rigid-
ion piezoelectric constant is -0.7455887 C/m^2 compared to the result found in
4 by a completely-GS finite difference calculation, -0.745589 C/m^2. The
agreement is now excellent!</p>
<p>The fully RF calculation in 2 in fact will converge much more rapidly with <strong>
k</strong> sample than the partial-finite-difference method introduced here.  Is it
worthwhile to have learned how to do this? We believe that is always pays to
have alternative ways to test results, and besides, this didn&rsquo;t take much
time. (Have you found the conversion factor on your own yet?)  </p>
<hr />
<h3 id="646-response-function-calculation-of-the-elastic-constants-of-al">**6. Response-function calculation of the elastic constants of Al<a class="headerlink" href="#646-response-function-calculation-of-the-elastic-constants-of-al" title="Permanent link">&para;</a></h3>
<p>metal.**</p>
<p>For metals, the existence of partially occupied bands is a complicating
feature for RF as well as GS calculations.  Now would be a good time to review
<a href="../lesson_base4.html">lesson 4</a> which dealt in detail with the interplay between
<strong> k</strong>-sample convergence and Fermi-surface broadening, especially section <a href="../lesson_base4.html#43">
4.3</a> .  You should copy telast_6.in and telast_6.files
into Work_elast, and begin your run while you read on, since it involves a
convergence study with multiple datasets and may take about two minutes.  </p>
<p>While the run is in progress, edit telast_6.in.  As in t43.in, we will set <a href="../../../input_variables/generated_files/varbas.html#udtset">
udtset</a> to specify a
double loop.  In the present case, however, the outer loop will be over 3
successively larger meshes of <strong>k</strong> points, while the inner loop will be
successively  </p>
<ol>
<li>GS self-consistent runs with optimization of acell.</li>
<li>GS density-generating run for the next step.</li>
<li>Non-self-consistent GS run to converge unoccupied or slightly-occupied bands.</li>
<li>RF run for symmetry-inequivalent elastic constants.</li>
</ol>
<p>In Section 1 , we did a separate GS structural optimization run and
transferred the results by hand to RF  run 2 .  Because we are doing a
convergence test here, we have combined these steps, and use <a href="../../../input_variables/generated_files/varrlx.html#getcell">
getcell</a> to
transfer the optimized coordinates from the first dataset of the inner loop
forward to the rest.  If we were doing a more complicated structure with
internal coordinates that were also optimized, we would need to use both this
and <a href="../../../input_variables/generated_files/varrlx.html#getxred"> getxred</a> to
transfer these, as in telast_1.in.  </p>
<p>The specific data for inner-loop dataset 1 is very similar to that for
telast_1.in.  Inner-loop dataset 2 is a bit of a hack.  We need the density
for inner-loop dataset 3, and while we could set <a href="../../../input_variables/generated_files/varfil.html#prtden">
prtden</a> = 1 in
dataset 1, this would produce a separate density file for every step in the
structural optimization, and it isn&rsquo;t clear how to automatically pick out the
last one.  So, dataset 2 picks up the wave functions from dataset 1 (only one
file of these is produced, for the optimized structure), does one more
iteration with fixed geometry, and writes a density file.  </p>
<p>Inner-loop dataset 3 is a non-self-consistent run whose purpose is to ensure
that all the wave functions specified by <a href="../../../input_variables/generated_files/varbas.html#nband">
nband</a> are well
converged. For metals, we have to specify enough bands to make sure that the
Fermi surface is properly calculated.  Bands above the  Fermi level which have
small occupancy or near-zero occupancy if their energies exceed the Fermi
energy by more than a few times<a href="../../../input_variables/generated_files/vargs.html#tsmear">
tsmear</a> , will have
very little effect on the self-consistent potential, so the <a href="../../../input_variables/generated_files/varbas.html#tolvrs">
tolvrs</a> test in
dataset 1 doesn&rsquo;t ensure their convergence.  Using <a href="../../../input_variables/generated_files/varbas.html#tolwfr">
tolwfr</a> in inner-
loop dataset 3 does.  Partially-occupied or unoccupied bands up to <a href="../../../input_variables/generated_files/varbas.html#nband">
nband</a>   play a
different role in constructing the first-order wave functions than do the many
unoccupied bands beyond <a href="../../../input_variables/generated_files/varbas.html#nband">
nband</a> which aren&rsquo;t
explicitly treated in Abinit, as discussed in  S. de Gironcoli, Phys. Rev. B
51, 6773 (1995).  By setting <a href="../../../input_variables/generated_files/varbas.html#nband">
nband</a> exactly equal
to the number of occupied bands for RF calculations for semiconductors and
insulators, we avoid having to deal with the issue of converging unoccupied
bands.  Could we avoid the extra steps by simply using <a href="../../../input_variables/generated_files/varbas.html#tolwfr">
tolwfr</a> instead of <a href="../../../input_variables/generated_files/varbas.html#tolvrs">
tolvrs</a> in dataset
1?  Perhaps, but experience has shown that this does not necessarily lead to
as well-converged a potential, and it is not recommended.  These same
considerations apply to phonon calculations for metals, or in particular to <a href="../../../input_variables/generated_files/vargs.html#qpt">
qpt</a> = 0 0 0 phonon
calculations for the interatomic force constants needed to find atom-
relaxation contributions to the elastic constants for non-trivial structures
as in 2 and 3 .  </p>
<p>The data specific to the elastic-tensor RF calculation in inner-loop dataset 4
should by now be familiar.  We take advantage of the fact that for cubic
symmetry the only symmetry-inequivalent elastic constants are C 11, C 12 , and
C 44 .  Abinit, unfortunately, does not do this analysis automatically, so we
specify <a href="../../../input_variables/generated_files/varrf.html#rfdir"> rfdir</a> =1 0
0 to avoid duplicate calculations.  (Note that if atom relaxation is to be
taken into account  for a more complex structure, the full set of directions
must be used.)  </p>
<p>When the telast_6 calculations finish, first look at telast_6.log as usual to
make sure they have run to completion without error.  Next, it would be a good
idea to look at the band occupancies occ?? (where ?? is a dual-loop dataset
index) reported at the end (following  ==END DATASET(S)==).  The highest band,
the fourth in this case, should have zero or very small occupation, or you
need to increase <a href="../../../input_variables/generated_files/varbas.html#nband">
nband</a> or decrease <a href="../../../input_variables/generated_files/vargs.html#tsmear">
tsmear</a> .  Now, use
your newly perfected knowledge of the Abinit perturbation indexing conventions
to scan through telast_6.out and find C 11 , C12 , and C 44 for each of the
three <strong>k</strong>-sample choices, which will be  under the &rdquo; Rigid-atom elastic
tensor&rdquo; heading.  Also find the lattice constants for each case, whose
convergence you studied in lesson 4.  You should be able to cut-and-paste
these into a table like the following,  </p>
<div class="codehilite"><pre><span></span>            C_11           C_12           C_44           acell
ngkpt=3*6   0.0037773556   0.0022583541   0.0013453692   7.5710952266
ngkpt=3*8   0.0042004431   0.0020423388   0.0013076763   7.5693986665
ngkpt=3*10  0.0042034396   0.0020343437   0.0012956768   7.5694820855
</pre></div>


<p>We can immediately see that the lattice constant converges considerably more
rapidly with <strong>k</strong> sample than the elastic constants.  For <a href="../../../input_variables/generated_files/varbas.html#ngkpt">
ngkpt</a> =3<em>6, acell is
converged to 0.02%, while the C&rsquo;s have 5-10% errors.  For <a class="wikilink" href="../../input_variables/varbas/#ngkpt">ngkpt</a> =3</em>8, the
C&rsquo;s are converged to better than 1%, much better for the largest, C11, which
should be acceptable.</p>
<p>As in lesson 4, the <a class="wikilink" href="../../input_variables/varbas/#ngkpt">ngkpt</a> convergence is controlled by <a href="../../../input_variables/generated_files/vargs.html#tsmear">
tsmear</a> .  The
smaller the broadening, the denser the <strong>k</strong> sample that is needed to get a
smooth variation of occupancy, and presumably stress, with strain.  While we
will not explore <a href="../../../input_variables/generated_files/vargs.html#tsmear">
tsmear</a> convergence
in this lesson, you may wish to do so on your own.  We believe that the value
<a href="../../../input_variables/generated_files/vargs.html#tsmear"> tsmear</a> = 0.02  in
telast_6.in gives results within 1% of the fully-converged small-broadening
limit.</p>
<p><strong>We find that</strong> <strong><a href="../../../input_variables/generated_files/varbas.html#occopt"> occopt</a> <strong><em>*=3, standard Fermi-Dirac broadening</em></strong>*, gives _ much better_ convergence of the C&rsquo;s than &ldquo;cold smearing.&rdquo;</strong>  Changing <a href="../../../input_variables/generated_files/varbas.html#occopt"> occopt</a> to 4 in telast_6.in, the option used in lesson 4, the C&rsquo;s show no sign of convergence.  At ngkpt=3*16, errors are still ~5%.  The reasons that this supposedly superior smoothing function performs so poorly in this context is a future research topic.  The main thing to be learned is that checking convergence with respect to all relevant parameters is <strong> always</strong> the user&rsquo;s responsibility.  Simple systems that include the main physical features of a complex system of interest will usually suffice for this testing.  Don&rsquo;t get caught publishing a result that another researcher refutes on convergence grounds, and don&rsquo;t blame such a mistake on Abinit!</p>
<p>Now we make a comparison with experiment.  Converting the C&rsquo;s to standard
units (Ha/Bohr^3 = 2.94210119E+04 GPa) and using zero-temperature extrapolated
experimental results from P. M. Sutton, Phys. Rev. 91, 816 (1953), we find  </p>
<div class="codehilite"><pre><span></span>                     C_11(GPa)  C_12(GPa)  C_44(GPa)
     Calculated        123.7      59.9       38.1
     Experiment (T=0)  123.0      70.8       30.9
</pre></div>


<p>Is this good agreement?  There isn&rsquo;t much literature on DFT calculations of
full sets of elastic constants.  Many calculations of the bulk modulus
(K=(C11+2C 12 )/3 in the cubic case) typically are within 10% of experiment
for the LDA.  Running telast_6 with ixc=11, the Perdew-Burke-Enzerhof GGA,
increases the calculated C&rsquo;s by 1-2%, and wouldn&rsquo;t be expected to make a large
difference for a nearly-free-electron metal.  </p>
<h3 id="comment-on-symmetry"><strong>Comment on symmetry</strong><a class="headerlink" href="#comment-on-symmetry" title="Permanent link">&para;</a></h3>
<p>It is important to bear in mind that the way a tensor like the elastic tensor
appears is a function of the frame used. Thus for the aluminum fcc case
considered above, the nonzero elements are <em>C11</em>, <em>C12</em>, and <em>C44</em>, _ provided
that the crystal axes are aligned with the laboratory frame. _ For an
arbitrary alignment of the crystal axes, many more <em>Cij</em> elements will be non-
zero, and this can be confusing. It&rsquo;s easy to see why this happens if you
imagine actually measuring the elastic tensor elements. If you start with the
conventional cubic cell, and apply pressure to one face, you can measure
<em>C11</em>. But if you turn the cell to some random angle, you&rsquo;ll measure a
response that is a mixture of <em>C11</em> and <em>C12</em>. Within ABINIT, if the aluminum
fcc cell is described using <a class="wikilink" href="../../input_variables/varbas/#angdeg">angdeg</a> and
<a href="../../../input_variables/generated_files/varbas.html#angdeg">acell</a>, then an
axis of the primitive cell will be aligned along the laboratory <em>z</em> axis but
this will not lead to a (conventional) cell alignment with the laboratory
frame. The resulting elastic tensor will be correct but will appear to be more
complicated than in the illustration above. It can be rotated back to a simple
frame by hand (bearing in mind that all four indices of the fourth-rank
elastic tensor have to be rotated!) but it&rsquo;s easier to start with a more
conventional alignment of the unit cell. If you use a standard text like
Bradley and Cracknell, The Mathematical Theory of Symmetry in Solids, Oxford
you can find the standard primitive cell descriptions for the Bravais lattice
types and these are aligned as much as possible with a standard laboratory
frame.</p>
<hr />
<p>This ABINIT lesson is now finished&hellip;</p></div>
        </div>

        <footer class="col-md-12">
<hr>

    <center>Abinit version 8.5.4</center>


    <center>Copyright &copy; 2017 The Abinit Group</center>


<center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

      <!--
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../extra_javascript/github_edit.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    -->

    </body>
</html>
