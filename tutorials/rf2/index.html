<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="The Abinit group">
        <link rel="canonical" href="http://www.abinit.org/tutorials/rf2/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>RF2 - abinit</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/codehilite.css" rel="stylesheet">
        <link href="../../css/extra.css" rel="stylesheet">
    
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
    <!-- <script src="../../js/somelib.js"></script> -->

    <!-- Jquery from Google CDN 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    -->

    <!-- Bootstrap http://getbootstrap.com/getting-started/ -->
    <!-- Latest compiled and minified CSS 

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    -->
    <!-- Optional theme

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    -->
    <!-- Latest compiled and minified JavaScript

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    -->

    <!-- MathJax support -->
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script> 
    <!--
    <script type="text/javascript" async 
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_SVG">
    </script> 
    -->

    <!--
    Configure MathJax to produce automatic equation numbers
    http://docs.mathjax.org/en/latest/tex.html
    -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          TeX: {
              equationNumbers: { autoNumber: "all" },
              extensions: ["AMSmath.js"],
              Macros: {
                  rr: "{\\bf r}",
                  GG: "{\\bf G}",
                  kk: "{\\bf k}",
                  qq: "{\\bf q}"
              }
          }
      });
    </script>

    <!-- See http://docs.mathjax.org/en/latest/start.html 
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        extensions: ["tex2jax.js", "MathMenu.js", "MathZoom.js"],
        jax: ["input/TeX", "output/HTML-CSS", "output/NativeMML],
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true
        },
        "HTML-CSS": { availableFonts: ["TeX"] }
      });
    </script>
    -->

 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">abinit</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../..">Introduction</a>
</li>
                            
<li >
    <a href="../../installation/">Installation</a>
</li>
                            
<li >
    <a href="../../user-guide/help_what_ABINIT_does/">Overview</a>
</li>
                            
<li >
    <a href="../../user-guide/help_abinit/">Abinit</a>
</li>
                            
<li >
    <a href="../../user-guide/help_mrgddb/">Mrgddb</a>
</li>
                            
<li >
    <a href="../../user-guide/help_optic/">Optic</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Topics <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../topics/">Complete List</a>
</li>
                            
<li >
    <a href="../../topics/Artificial/">Artificial</a>
</li>
                            
<li >
    <a href="../../topics/AtomManipulator/">AtomManipulator</a>
</li>
                            
<li >
    <a href="../../topics/AtomTypes/">AtomTypes</a>
</li>
                            
<li >
    <a href="../../topics/Bader/">Bader</a>
</li>
                            
<li >
    <a href="../../topics/BandOcc/">BandOcc</a>
</li>
                            
<li >
    <a href="../../topics/Berry/">Berry</a>
</li>
                            
<li >
    <a href="../../topics/BSE/">BSE</a>
</li>
                            
<li >
    <a href="../../topics/ConstrainedPol/">ConstrainedPol</a>
</li>
                            
<li >
    <a href="../../topics/Control/">Control</a>
</li>
                            
<li >
    <a href="../../topics/Coulomb/">Coulomb</a>
</li>
                            
<li >
    <a href="../../topics/CRPA/">CRPA</a>
</li>
                            
<li >
    <a href="../../topics/crystal/">Crystal</a>
</li>
                            
<li >
    <a href="../../topics/Dev/">Dev</a>
</li>
                            
<li >
    <a href="../../topics/DFPT/">DFPT</a>
</li>
                            
<li >
    <a href="../../topics/DFT+U/">DFT+U</a>
</li>
                            
<li >
    <a href="../../topics/DMFT/">DMFT</a>
</li>
                            
<li >
    <a href="../../topics/EffMass/">EffMass</a>
</li>
                            
<li >
    <a href="../../topics/EFG/">EFG</a>
</li>
                            
<li >
    <a href="../../topics/Elastic/">Elastic</a>
</li>
                            
<li >
    <a href="../../topics/ElecBandStructure/">ElecBandStructure</a>
</li>
                            
<li >
    <a href="../../topics/ElecDOS/">ElecDOS</a>
</li>
                            
<li >
    <a href="../../topics/ElPhonInt/">ElPhonInt</a>
</li>
                            
<li >
    <a href="../../topics/ElPhonTransport/">ElPhonTransport</a>
</li>
                            
<li >
    <a href="../../topics/ForcesStresses/">ForcesStresses</a>
</li>
                            
<li >
    <a href="../../topics/FrequencyMeshMBPT/">FrequencyMeshMBPT</a>
</li>
                            
<li >
    <a href="../../topics/GeoConstraints/">GeoConstraints</a>
</li>
                            
<li >
    <a href="../../topics/GeoOpt/">GeoOpt</a>
</li>
                            
<li >
    <a href="../../topics/GW/">GW</a>
</li>
                            
<li >
    <a href="../../topics/GWls/">GWls</a>
</li>
                            
<li >
    <a href="../../topics/Hybrids/">Hybrids</a>
</li>
                            
<li >
    <a href="../../topics/">Home</a>
</li>
                            
<li >
    <a href="../../topics/k-points/">K points</a>
</li>
                            
<li >
    <a href="../../topics/LOTF/">LOTF</a>
</li>
                            
<li >
    <a href="../../topics/MagField/">MagField</a>
</li>
                            
<li >
    <a href="../../topics/MagMom/">MagMom</a>
</li>
                            
<li >
    <a href="../../topics/MolecularDynamics/">MolecularDynamics</a>
</li>
                            
<li >
    <a href="../../topics/multidtset/">Multidtset</a>
</li>
                            
<li >
    <a href="../../topics/nonlinear/">Nonlinear</a>
</li>
                            
<li >
    <a href="../../topics/Optic/">Optic</a>
</li>
                            
<li >
    <a href="../../topics/Output/">Output</a>
</li>
                            
<li >
    <a href="../../topics/parallelism/">Parallelism</a>
</li>
                            
<li >
    <a href="../../topics/PAW/">PAW</a>
</li>
                            
<li >
    <a href="../../topics/PhononBands/">PhononBands</a>
</li>
                            
<li >
    <a href="../../topics/Phonons/">Phonons</a>
</li>
                            
<li >
    <a href="../../topics/PhononWidth/">PhononWidth</a>
</li>
                            
<li >
    <a href="../../topics/PIMD/">PIMD</a>
</li>
                            
<li >
    <a href="../../topics/Planewaves/">Planewaves</a>
</li>
                            
<li >
    <a href="../../topics/positron/">Positron</a>
</li>
                            
<li >
    <a href="../../topics/printing/">Printing</a>
</li>
                            
<li >
    <a href="../../topics/PseudosPAW/">PseudosPAW</a>
</li>
                            
<li >
    <a href="../../topics/q-points/">Q points</a>
</li>
                            
<li >
    <a href="../../topics/RandStopPow/">RandStopPow</a>
</li>
                            
<li >
    <a href="../../topics/Recursion/">Recursion</a>
</li>
                            
<li >
    <a href="../../topics/RPACorrEn/">RPACorrEn</a>
</li>
                            
<li >
    <a href="../../topics/SCFAlgorithms/">SCFAlgorithms</a>
</li>
                            
<li >
    <a href="../../topics/SCFControl/">SCFControl</a>
</li>
                            
<li >
    <a href="../../topics/SelfEnergy/">SelfEnergy</a>
</li>
                            
<li >
    <a href="../../topics/SmartSymm/">SmartSymm</a>
</li>
                            
<li >
    <a href="../../topics/spinpolarisation/">Spinpolarisation</a>
</li>
                            
<li >
    <a href="../../topics/STM/">STM</a>
</li>
                            
<li >
    <a href="../../topics/Susceptibility/">Susceptibility</a>
</li>
                            
<li >
    <a href="../../topics/TDDFT/">TDDFT</a>
</li>
                            
<li >
    <a href="../../topics/TDepES/">TDepES</a>
</li>
                            
<li >
    <a href="../../topics/Temperature/">Temperature</a>
</li>
                            
<li >
    <a href="../../topics/TransPath/">TransPath</a>
</li>
                            
<li >
    <a href="../../topics/TuningSpeed/">TuningSpeed</a>
</li>
                            
<li >
    <a href="../../topics/UnitCell/">UnitCell</a>
</li>
                            
<li >
    <a href="../../topics/vdw/">Vdw</a>
</li>
                            
<li >
    <a href="../../topics/Wannier/">Wannier</a>
</li>
                            
<li >
    <a href="../../topics/Wavelets/">Wavelets</a>
</li>
                            
<li >
    <a href="../../topics/xc/">Xc</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Input Variables <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">Abinit</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../input_variables/varlist_abinit/">All Variables</a>
</li>
            
<li >
    <a href="../../input_variables/basic/">Basic</a>
</li>
            
<li >
    <a href="../../input_variables/bse/">Bethe-Salpeter</a>
</li>
            
<li >
    <a href="../../input_variables/dev/">Developers</a>
</li>
            
<li >
    <a href="../../input_variables/dmft/">DMFT</a>
</li>
            
<li >
    <a href="../../input_variables/eph/">Electron-Phonon</a>
</li>
            
<li >
    <a href="../../input_variables/ffield/">Varff</a>
</li>
            
<li >
    <a href="../../input_variables/files/">File-handling</a>
</li>
            
<li >
    <a href="../../input_variables/geo/">Geometry</a>
</li>
            
<li >
    <a href="../../input_variables/gstate/">Ground-State</a>
</li>
            
<li >
    <a href="../../input_variables/gw/">GW</a>
</li>
            
<li >
    <a href="../../input_variables/internal/">Internal</a>
</li>
            
<li >
    <a href="../../input_variables/paral/">Parallelism</a>
</li>
            
<li >
    <a href="../../input_variables/paw/">PAW</a>
</li>
            
<li >
    <a href="../../input_variables/dfpt/">DFPT</a>
</li>
            
<li >
    <a href="../../input_variables/rlx/">Relaxation</a>
</li>
            
<li >
    <a href="../../input_variables/vdw/">VdW</a>
</li>
            
<li >
    <a href="../../input_variables/w90/">Wannier90</a>
</li>
    </ul>
  </li>
                            
<li >
    <a href="../../input_variables/anaddb/">Anaddb</a>
</li>
                            
<li >
    <a href="../../input_variables/optic/">Optic</a>
</li>
                            
<li >
    <a href="../../input_variables/aim/">Aim</a>
</li>
                            
<li >
    <a href="../../input_variables/varset_stats/">Statistics</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Lessons <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../welcome/">Overview</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Base Tutorials</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../base1/">Base1</a>
</li>
            
<li >
    <a href="../base2/">Base2</a>
</li>
            
<li >
    <a href="../base3/">Base3</a>
</li>
            
<li >
    <a href="../base4/">Base4</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">DFPT</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../rf1/">RF1</a>
</li>
            
<li class="active">
    <a href="./">RF2</a>
</li>
            
<li >
    <a href="../elastic/">Elastic</a>
</li>
            
<li >
    <a href="../eph/">EPH</a>
</li>
    </ul>
  </li>
                            
<li >
    <a href="../dmft/">DMFT</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Many-Body</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../gw1/">GW1</a>
</li>
            
<li >
    <a href="../gw2/">GW2</a>
</li>
            
<li >
    <a href="../bse/">Bethe-Salpeter</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Parallelism</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../basepar/">Base</a>
</li>
            
<li >
    <a href="../paral_mbt/">Many-Body</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Theory <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../theory/theory_mbt/">MBPT</a>
</li>
                            
<li >
    <a href="../../theory/additional_material/">Additional Material</a>
</li>
                            
<li >
    <a href="../../bibliography/">Bibliography</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developers <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../developers/README/">How to write docs</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../about/release-notes/">Release Notes</a>
</li>
                            
<li >
    <a href="../../about/contributing/">Contributing</a>
</li>
                            
<li >
    <a href="../../about/license/">License</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../rf1/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../elastic/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/abinit/abinit/">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#146-generation-of-the-derivative-databases">1. Generation of the derivative databases</a></li>
        <li class="main "><a href="#246-manipulation-of-the-derivative-databases-the-mrgddb-utility">2. Manipulation of the derivative databases (the MRGDDB utility)</a></li>
        <li class="main "><a href="#346-analysis-of-the-derivative-databases-the-anaddb-utility">3. Analysis of the derivative databases (the ANADDB utility)</a></li>
        <li class="main "><a href="#446-the-computation-of-interatomic-force-constants">4. The computation of interatomic force constants</a></li>
        <li class="main "><a href="#546-the-efficient-computation-of-phonon-band-structures">5. The efficient computation of phonon band structures</a></li>
        <li class="main "><a href="#646-thermodynamical-properties">6. Thermodynamical properties.</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<!-- Return to Top -->

<p><a href="javascript:" id="return-to-top"><i class="glyphicon glyphicon-chevron-up"></i></a>
This lesson aims at showing how to get the following physical properties, for
periodic solids :</p>
<ul>
<li>Interatomic forces constants </li>
<li>Phonon band structures </li>
<li>Thermodynamical properties </li>
</ul>
<p>This lesson should take about 1 hour.</p>
<ul>
<li>
<ol>
<li>Generation of a derivative database </li>
</ol>
</li>
<li>
<ol>
<li>Manipulation of the derivative databases (the MRGDDB utility) </li>
</ol>
</li>
<li>
<ol>
<li>Analysis of the derivative databases (the ANADDB utility) </li>
</ol>
</li>
<li>
<ol>
<li>The computation of interatomic force constants </li>
</ol>
</li>
<li>
<ol>
<li>The efficient computation of phonon band structures </li>
</ol>
</li>
<li>
<ol>
<li>Thermodynamical properties. </li>
</ol>
</li>
</ul>
<hr />
<h3 id="146-generation-of-the-derivative-databases"><strong> 1. Generation of the derivative databases </strong><a class="headerlink" href="#146-generation-of-the-derivative-databases" title="Permanent link">&para;</a></h3>
<p>_Before beginning, you might consider to work in a different subdirectory as
for the other lessons. Why not create "Work_rf2" in
~abinit/tests/tutorespfn/Input ? _</p>
<p>This tutorial starts by the generation of a database, that is quite time-
consuming. We suggest you to start immediately this computation...<br />
Copy the files ~abinit/tests/tutorespfn/Input/trf2_1.files and
~abinit/tests/tutorespfn/Input/trf2_1.in in "Work_rf2" .</p>
<p>Issue now :</p>
<ul>
<li>_ abinit &lt; trf2_1.files &gt;&amp; log &amp;_</li>
</ul>
<p>It takes about 15 minutes to be completed on a PC 2.8 GHz ...</p>
<p>In order to do interatomic force constant calculations, and to compute
associated phonon band structure and thermodynamical properties, you should
first have some theoretical background.<br />
Let us assume that you have read the litterature relative to the <a href="../lesson_rf1.html">first lesson
on response functions</a>. You might find additional material,
related to the present section, in the following references:  </p>
<p>X. Gonze and C. Lee, Phys. Rev. B55, 10355 (1997), especially section IX<br />
C. Lee, X. Gonze, Phys. Rev. B 51, 8610 (1995)<br />
S. Baroni, S. de Gironcoli, A. Dal Corso, P. Giannozzi, Rev. Mod. Phys. 73,
515 (2001).</p>
<p>If you haven't read parts of these references, you should take the time to get
and read them now.</p>
<p>In short, the idea is that, in order to compute properties for which the
phonon frequencies are needed in all the Brillouin zone, one can use an
elaborate Fourier interpolation, so that only few dynamical matrices need to
be computed directly. Others will be computed by interpolation.</p>
<p>Let us have a look at the input file trf2_1.in . The calculation is done for
AlAs, the same crystalline material as for the previous lesson on response
functions. Many input parameters are also quite similar, both at the level of
the description of the unit cell, as for the choice of cut-off energy and k
point grid.</p>
<p>Still, this input file is rather complex : in one single run, one produces the
(Derivative Databases) DDBs needed for the rest of this tutorial. So, it
starts with a ground-state calculation (dataset 1), followed by the
computation of the response to the d/dk perturbation (dataset 2), and the
response to electric fields, and phonons at Gamma (dataset 3). Datasets 4 to
10 generate the dynamical matrices at 7 q wavevectors, other than Gamma. At
present (v4.6), one can only compute one q point per dataset, that is why so
many datasets are needed.</p>
<p>Also, the values of these q wavevectors are not determined automatically. They
must correspond to the q wavevectors needed by the ANADDB utility (see later),
that is, they should form a reduced set of symmetry-inequivalent wavevectors,
corresponding to a regularly spaced grid. In principle, they ought not include
the Gamma point, but it is recommended to have it in the set, in order for the
Fourier interpolation not to introduce errors at that important point. In
order to minimize the number of preliminary non-self-consistent calculations,
it is advised to take a q point mesh that is adjusted to the k point mesh used
for the electronic structure : all q wavevectors should connect two k point
wavevectors from this grid.</p>
<p>Such a set of q wavevectors can be generated straightforwardly by running a GS
calculation with <a class="wikilink" href="../../input_variables/basic/#kptopt">kptopt</a>=1, <a class="wikilink" href="../../input_variables/basic/#nshiftk">nshiftk</a>=1, <a class="wikilink" href="../../input_variables/basic/#shiftk">shiftk</a>=0 0 0 (to include
gamma) and taking the output kpt set file as this qpt set. One might set
<a class="wikilink" href="../../input_variables/basic/#nstep">nstep</a>=1 and <a class="wikilink" href="../../input_variables/gstate/#nline">nline</a>=1, so only one iteration runs.<br />
The input file ~abinit/tests/tutorespfn/Input/trf2_2.in is precisely an input
file that can be used to generate such a set of k points. Copy it in the
present Work_rf2 directly, as well as the accompanying
~abinit/tests/tutorespfn/Input/trf2_2.files. Examine these files, then run
this calculation (it is very rapid - it won't hurt the trf2_1 job). The
following k point set is obtained :</p>
<pre><code>       kpt    0.00000000E+00  0.00000000E+00  0.00000000E+00
              2.50000000E-01  0.00000000E+00  0.00000000E+00
              5.00000000E-01  0.00000000E+00  0.00000000E+00
              2.50000000E-01  2.50000000E-01  0.00000000E+00
              5.00000000E-01  2.50000000E-01  0.00000000E+00
             -2.50000000E-01  2.50000000E-01  0.00000000E+00
              5.00000000E-01  5.00000000E-01  0.00000000E+00
             -2.50000000E-01  5.00000000E-01  2.50000000E-01
</code></pre>
<p>It is, as promised, the same as the q point set in the trf2_1.in file.</p>
<p>Now, it might be worth to examine in some detail one of the Derivative
Database that has been created by the trf2_1 run. We suppose that the file
trf2_1o_DS3_DDB has already been created. It corresponds to the third dataset,
namely the response to q=0 and electric field.<br />
Edit this file, and read the
<a href="../../../users/generated_files/help_respfn.html#6.5">6.5</a> section of the
respfn_help.html file. Examine the trf2_1o_DS3_DDB file carefully.</p>
<p>Seven other similar files will be generated by the trf2_1 run, containing the
same header, but a different 2DTE block. It will be the duty of the MRGDDB
utility, next section, to gather all these information.</p>
<p>Now, there might be two possibilities : either the trf2_1 run is finished, and
you can continue the tutorial with the section 2 about the MRGDDB utility, or
the run is not finished.<br />
In the latter case, instead of waiting for trf2_1 to be finished, we suggest
you to pursue with section 3. You will use as DDB file the one that can be
found in ~abinit/tests/tutorespfn/Refs, with the name trf2_3.ddb.out,
<a class="wikilink" href="../../tests/tutorespfn/Refs/trf2_3.ddb.out">tests/tutorespfn/Refs/trf2_3.ddb.out</a>, instead of the one that would result
from the section 2. Copy this file to the present directory, then go to
section section 3 of this tutorial. You might come back to section 2
afterwards.</p>
<hr />
<h3 id="246-manipulation-of-the-derivative-databases-the-mrgddb-utility"><strong> 2. Manipulation of the derivative databases (the MRGDDB utility) </strong><a class="headerlink" href="#246-manipulation-of-the-derivative-databases-the-mrgddb-utility" title="Permanent link">&para;</a></h3>
<p>The use of the MRGDDB utility is described in its <a href="../../../users/generated_files/help_mrgddb.html">help
file</a>. Please, read it carefully
now.</p>
<p>Use MRGDDB to create the merge DDB from the eight DDB's corresponding to
datasets 3 to 10 of the trf2_1 job, containing the dynamical matrices for the
8 q points, as well as the response to the electric field (dielectric tensor
and Born effective charges). Including also the one from dataset 1 won't hurt
(it contains the forces and stresses), but is not needed for the computation
of phonon band structure, interatomic force constants, and thermodynamical
properties. Name the new DDB trf2_3.ddb.out .</p>
<p>File ~abinit/tests/tutorespfn/Input/trf2_3.in is an example of input file for
MRGDDB. You can copy it in the Work_rf2 directory, and run the merge as
follows :</p>
<pre><code>mrgddb &lt; trf2_3.in
</code></pre>
<p>It takes less than one second on a typical PC.</p>
<hr />
<h3 id="346-analysis-of-the-derivative-databases-the-anaddb-utility"><strong> 3. Analysis of the derivative databases (the ANADDB utility) </strong><a class="headerlink" href="#346-analysis-of-the-derivative-databases-the-anaddb-utility" title="Permanent link">&para;</a></h3>
<p>An introduction to the use of the ANADDB utility is described in its <a href="../../../users/generated_files/help_anaddb.html">help
file</a>. Please, read it carefully
now.</p>
<p>This ANADDB utility is able to perform many different tasks, each governed by
a selected set of input variables, with also some input variables common to
many of the different tasks. The list of tasks to be done in one run is
governed by different flags. Here is the list of flags :</p>
<ul>
<li><a href="../../../users/generated_files/help_anaddb.html#dieflag">dieflag</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#elaflag">elaflag</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#elphflag">elphflag</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#ifcflag">ifcflag</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#instrflag">instrflag</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#nlflag">nlflag</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#piezoflag">piezoflag</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#polflag">polflag</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#thmflag">thmflag</a></li>
</ul>
<p>Please, take some time to read the description of each of these flags. Note
that some of these flags might be required to allow to run another task.</p>
<p>In this tutorial, we will focus on the flags
<a href="../../../users/generated_files/help_anaddb.html#ifcflag">ifcflag</a> and
<a href="../../../users/generated_files/help_anaddb.html#thmflag">thmflag</a></p>
<hr />
<h3 id="446-the-computation-of-interatomic-force-constants"><strong> 4. The computation of interatomic force constants </strong><a class="headerlink" href="#446-the-computation-of-interatomic-force-constants" title="Permanent link">&para;</a></h3>
<p>You can copy the files ~abinit/tests/tutorespfn/Input/trf2_4.in and
~abinit/tests/tutorespfn/Input/trf2_4.files to the Work_rf2 directory.<br />
Edit the file trf2_4.in . Note that
<a href="../../../users/generated_files/help_anaddb.html#ifcflag">ifcflag</a> is activated.
Related input variables can be split in three groups.</p>
<p>The first group of variables define the grid of q wavevectors :</p>
<ul>
<li><a href="../../../users/generated_files/help_anaddb.html#brav">brav</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#ngqpt">nqgpt</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#nqshft">nqshft</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#q1shft">q1shft</a></li>
</ul>
<p>Unfortunately, the names of input variables and their meaning is not exactly
the same as the names used to generate the k points in ABINIT. This is a
shame, a remnant of history ... Please read carefully the documentation that
describes these input variables.</p>
<p>The second group of variables allows to impose some known constraint on the
dynamical matrices and Born effective charges before proceeding with the
analysis :</p>
<ul>
<li><a href="../../../users/generated_files/help_anaddb.html#asr">asr</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#chneut">chneut</a></li>
</ul>
<p>Please, read carefully the explanation for these input variables.</p>
<p>Finally, a third group of variables is related specifically to the analysis of
the Interatomic Force Constants :</p>
<ul>
<li><a href="../../../users/generated_files/help_anaddb.html#dipdip">dipdip</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#ifcana">ifcana</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#ifcout">ifcout</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#natifc">natifc</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#atifc">atifc</a></li>
</ul>
<p>Here also, spend some time to read the associated documentation.</p>
<p>Now, you should issue :</p>
<pre><code>anaddb &lt; trf2_4.files &gt; trf2_4.log
</code></pre>
<p>It will last only a few seconds.</p>
<p>The file trf2_4.out contains the list of interatomic force constants, as well
as some analysis. Edit this file.<br />
Try to find the following paragraph :</p>
<pre><code> Analysis of interatomic force constants

 Are given : column(1-3), the total force constant
       then  column(4-6), the Ewald part
       then  column(7-9), the short-range part
 Column 1, 4 and 7 are related to the displacement
       of the generic atom along x,
 column 2, 5 and 8 are related to the displacement
       of the generic atom along y,
 column 3, 6 and 9 are related to the displacement
       of the generic atom along z.
</code></pre>
<p>The interatomic force constants are output for the nuclei specified by the
input variable <a href="../../../users/generated_files/help_anaddb.html#atifc">atifc</a>.
Here, only atom 1 is considered. The IFCs with respect to the other nuclei is
given, by order of increasing distance. For each pair of nuclei involving atom
1, there is first the output of the IFCs in cartesian coordinates, as well as
their decomposition into an Ewald and a short-range part, then, the analysis
with respect to a local system of coordinate. The latter is chosen such as to
diagonalize the IFC tensor, in case of the self-force constant, and in the
other cases, the first vector is the vector joining the two nuclei, in order
to decompose the IFC into a longitudinal and a transverse component.</p>
<hr />
<h3 id="546-the-efficient-computation-of-phonon-band-structures"><strong> 5. The efficient computation of phonon band structures </strong><a class="headerlink" href="#546-the-efficient-computation-of-phonon-band-structures" title="Permanent link">&para;</a></h3>
<p>You can copy the files ~abinit/tests/tutorespfn/Input/trf2_5.in and
~abinit/tests/tutorespfn/Input/trf2_5.files to the Work_rf2 directory.<br />
Edit the file trf2_5.in . Note that
<a href="../../../users/generated_files/help_anaddb.html#ifcflag">ifcflag</a> is again
activated. Indeed, in order to compute a phonon band structure using the
Fourier interpolation, the IFCs are required. This is why the two first groups
of variables, needed to generate the IFCs are still defined. The third group
of variables is now restricted to
<a href="../../../users/generated_files/help_anaddb.html#dipdip">dipdip</a> only.</p>
<p>Then, come the input variables needed to define the list of q wavevectors in
the band structure :</p>
<ul>
<li><a href="../../../users/generated_files/help_anaddb.html#eivec">eivec</a>: flag to turn on the analysis of phonon eigenvectors</li>
<li><a href="../../../users/generated_files/help_anaddb.html#nph1l">nph1l</a> number of q-points for phonon interpolation</li>
<li><a href="../../../users/generated_files/help_anaddb.html#qph1l">qph1l</a> list of q-points for phonon interpolation</li>
<li><a href="../../../users/generated_files/help_anaddb.html#nph2l">nph2l</a> number of q-directions for LO-TO correction</li>
<li><a href="../../../users/generated_files/help_anaddb.html#qph2l">qph2l</a> list of q-directions for LO-TO correction</li>
</ul>
<p>Now, you should issue :</p>
<pre><code>anaddb &lt; trf2_5.files &gt; trf2_5.log
</code></pre>
<p>It will last only a few seconds.</p>
<p>The file trf2_5.out contains the list of eigenvalues, for all the needed
q-wavevectors. You can edit it, and have a look at the different sections of
the file. Note that the interatomic force constants are computed (they are
needed for the Fourier interpolation), but not printed.</p>
<p>Please, edit also the other output file, named trf2_5_B2EPS.freq . It contains
the frequencies, in a format suitable for graphical output, using the program
band2eps (the latter should be more documented, and will not be described in
the present tutorial).</p>
<p>You can copy the files <a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../tests/tutorespfn/Input/trf2_6.in" title="Input file for 'band2eps.' This data layout must be used,  line-by-line.">tests/tutorespfn/Input/trf2_6.in</a> and
<a class="wikilink" href="../../tests/tutorespfn/Input/trf2_6.files">tests/tutorespfn/Input/trf2_6.files</a> to the Work_rf2 directory, then issue</p>
<pre><code>band2eps &lt; trf2_6.files &gt; trf2_6.log
</code></pre>
<p>The file trf2_6.out.eps has been produced. It is an .eps file (eps stand for
Encapsulated PostScript). You can use the program ghostview to vizualize it.
The command to issue will depend on the way you have configured your machine,
but the following might perhaps do the work:</p>
<pre><code>gv trf2_6.out.eps
</code></pre>
<p>You should see a nice phonon band structure for AlAs. Well, not so nice, after
all, because there are two strange dips for the highest phonon band, at the
Gamma point.<br />
This is due to the lack of LO-TO splitting for the ANADDB treatment of the
first list of vector. The correct phonon band structure is presented
<a href="../../documents/lesson_rf2/trf2_6.out.eps">here</a>. You can correct the LO-TO
splitting by the following little hack.</p>
<p>Edit the file trf2_5_B2EPS.freq, and note that the value of the frequency, in
the sixth column, has a discontinuity exactly for the Gamma point (the three
first columns give the k point coordinates), that is, at lines 1 and 31 :</p>
<pre><code> 0.000000D+00  0.000000D+00  0.000000D+00  0.156855D-02  0.156855D-02  0.156855D-02
</code></pre>
<p>Replace these values (sixth column, line 1 and 31) by the correct value,
including the LO-TO splitting, that you can find in the file trf2_5.out, at
the end, second list of vector. That is, the lines 1 and 31 should now read :</p>
<pre><code> 0.000000D+00  0.000000D+00  0.000000D+00  0.156855D-02  0.156855D-02  1.730353E-03
</code></pre>
<p>Now, run again band2eps. Your phonon band structure should be perfect !</p>
<p>It can be compared with the AlAs phonon band structure published by<br />
P. Giannozzi, S. de Gironcoli, P. Pavone, and S. Baroni, Phys. Rev. B 43, 7231
(1991).</p>
<p>Of course, one should make a convergence study, on the k and q point grids
(separately !), as well as on the energy cut-off, and also test LDA and GGA
... But this is left to the user !</p>
<hr />
<h3 id="646-thermodynamical-properties"><strong> 6. Thermodynamical properties. </strong><a class="headerlink" href="#646-thermodynamical-properties" title="Permanent link">&para;</a></h3>
<p>We will give only a very short example of the use of ANADDB to compute
thermodynamical properties. This is because this part of ANADDB is likely the
farthest from a clean, stable, usage. By exploring the input variables, the
user should be able to produce figures and data like the ones for SiO2 quartz
and stishovite, published in<br />
C. Lee, X. Gonze, Phys. Rev. B 51, 8610 (1995)</p>
<p>You can copy the files ~abinit/tests/tutorespfn/Input/trf2_7.in and
~abinit/tests/tutorespfn/Input/trf2_7.files to the Work_rf2 directory, and
have a look at them.<br />
The same DDB as for trf2_4 and trf2_5 is used, namely trf2_3.ddb.out. The
following additional input variables are present :</p>
<ul>
<li><a href="../../../users/generated_files/help_anaddb.html#thmflag">thmflag</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#ng2qpt">ng2qpt</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#ngrids">ngrids</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#q2shft">q2shft</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#nchan">nchan</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#nwchan">nwchan</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#thmtol">thmtol</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#ntemper">ntemper</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#temperinc">temperinc</a></li>
<li><a href="../../../users/generated_files/help_anaddb.html#tempermin">tempermin</a></li>
</ul>
<p>Examine the input file, the input variables, then run anaddb (as usual ...).
Then, edit the output file. You should be able to find the crucial section :</p>
<pre><code># At  T     F(J/mol-c)     E(J/mol-c)     S(J/(mol-c.K)) C(J/(mol-c.K))
# (A mol-c is the abbreviation of a mole-cell, that is, the
#  number of Avogadro times the atoms in a unit cell)
 2.000E+01  8.1384755E+03  8.1463588E+03  3.9416455E-01  1.4169104E+00
 4.000E+01  8.1061318E+03  8.2368069E+03  3.2668770E+00  7.8985031E+00
 6.000E+01  7.9980215E+03  8.4575659E+03  7.6590742E+00  1.3992228E+01
 8.000E+01  7.7974375E+03  8.7915524E+03  1.2426436E+01  1.9325166E+01
 1.000E+02  7.5004822E+03  9.2274431E+03  1.7269609E+01  2.4175006E+01
 1.200E+02  7.1069991E+03  9.7544364E+03  2.2061978E+01  2.8411189E+01
 1.400E+02  6.6189291E+03  1.0359248E+04  2.6716565E+01  3.1955267E+01
 1.600E+02  6.0396227E+03  1.1028289E+04  3.1179167E+01  3.4847423E+01
 1.800E+02  5.3732223E+03  1.1749439E+04  3.5423427E+01  3.7183864E+01
 2.000E+02  4.6241910E+03  1.2512641E+04  3.9442251E+01  3.9069448E+01
</code></pre>
<p>There, one finds, the phonon free energy, the phonon internal energy, the
phonon entropy and the phonon heat capacity.</p>
<p>Do not forget that we are working in the harmonic approximation ; beyond some
temperature, anharmonic effects will have a sizeable contributions.</p>
<p>The atomic temperature factors can also be computed. An example is presented
in tests/v5 , test 22 .</p></div>
        </div>

        <footer class="col-md-12">
<hr>

    <center>Abinit version 8.5.4</center>


    <center>Copyright &copy; 2017 The Abinit Group</center>


<center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>
        <script>var base_url = '../..';</script>
        <!--
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        -->
        <script src="../../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.8/ace.js"></script>
        <script src="../../extra_javascript/abidocs.js"></script>

    <!--<script>var base_url = '../..';</script>
<script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>

<h1 id="search">Search Results</h1>

<form action="search.html">
  <input name="q" id="mkdocs-search-query" type="text" >
</form>

<div id="mkdocs-search-results">
  Sorry, page not found.
</div>
    -->

    </body>
</html>
