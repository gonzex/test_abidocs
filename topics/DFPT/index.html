<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="The Abinit group">
    <link rel="canonical" href="http://www.abinit.org/topics/DFPT/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>DFPT - abinit</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../css/codehilite.css" rel="stylesheet">
    <link href="../../css/extra.css" rel="stylesheet">
    
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <!-- <script src="../../js/somelib.js"></script> -->

    <!-- Jquery from Google CDN 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    -->

    <!-- Bootstrap http://getbootstrap.com/getting-started/ -->
    <!-- Latest compiled and minified CSS 

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    -->
    <!-- Optional theme

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    -->
    <!-- Latest compiled and minified JavaScript

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    -->

    <!-- MathJax support -->
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script> 
    <!--
    <script type="text/javascript" async 
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_SVG">
    </script> 
    -->

    <!--
    Configure MathJax to produce automatic equation numbers
    http://docs.mathjax.org/en/latest/tex.html
    -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          TeX: {
              equationNumbers: { autoNumber: "all" },
              extensions: ["AMSmath.js"],
              Macros: {
                  rr: "{\\bf r}",
                  GG: "{\\bf G}",
                  kk: "{\\bf k}",
                  qq: "{\\bf q}"
              }
          }
      });
    </script>

    <!-- See http://docs.mathjax.org/en/latest/start.html 
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        extensions: ["tex2jax.js", "MathMenu.js", "MathZoom.js"],
        jax: ["input/TeX", "output/HTML-CSS", "output/NativeMML],
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true
        },
        "HTML-CSS": { availableFonts: ["TeX"] }
      });
    </script>
    -->


    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Introduction", url: "#introduction", children: [
          ]},
          {title: "Related Input Variables", url: "#related-input-variables", children: [
          ]},
          {title: "Selected Input Files", url: "#selected-input-files", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.8/ace.js"></script>
      <script src="../../extra_javascript/abidocs.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../DFT+U/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../DFT+U/" class="btn btn-xs btn-link">
        DFT+U
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Dev/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Dev/" class="btn btn-xs btn-link">
        Dev
      </a>
    </div>
    
  </div>

    

    <!-- Return to Top -->

<h2 id="_1"><a href="javascript:" id="return-to-top"><i class="glyphicon glyphicon-chevron-up"></i></a><a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h2 id="introduction"><strong> Introduction </strong><a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Density-Functional Perturbation Theory (DFPT) allows one to address a large
variety of physical observables. Many properties of interest can be computed
directly from the derivatives of the energy, without the use of finite
differences: phonons modes, elastic tensors, effective charges, dielectric
tensors, etc... Even non-linear properties can be computed, like the Raman
intensities (for the latter, see <a class="wikilink" href="../../topic_nonlinear/">topic_nonlinear</a>)..</p>
<p>A DFPT calculation workflow is conducted as follows:</p>
<ul>
<li>Run a Ground-State calculation in order to extract the Kohn-Sham pseudo wave-functions; these must be extremely well converged.</li>
<li>If necessary, e.g., for the application of the derivative of the Hamiltonian with respect to an electric field, determine the derivatives of the wave functions with respect to the wave vector <strong>k</strong>, and keep them in a file. The keyword <a class="wikilink" href="../../input_variables/dfpt/#rfddk">rfddk</a> is used to perform this type of calculation.</li>
<li>Compute the 2nd-order derivative matrix (i.e., 2nd derivatives of the energy with respect to different perturbations λ). This can be done thanks to the keywords <a class="wikilink" href="../../input_variables/dfpt/#rfphon">rfphon</a> (λ=atomic displacement), <a class="wikilink" href="../../input_variables/dfpt/#rfstrs">rfstrs</a> (λ=strain), <a class="wikilink" href="../../input_variables/dfpt/#rfelfd">rfelfd</a> (λ=electric field) or <a class="wikilink" href="../../input_variables/dfpt/#rfmagn">rfmagn</a> (λ=magnetic field). </li>
<li>Launch the anaddb tool (distributed with ABINIT) to analyse the derivative database and compute relaxed tensors and thermodynamical properties.</li>
</ul>
<p>Note that for PAW calculation, when performing the post-processing with
anaddb, it is recommended to include all the keywords enforcing the sum rules
(acoustic sum and charge neutrality). Indeed the PAW formalism involves, for
each atom, the calculation of a large number of real space integrals, whose
numerical effect may be to break the translational invariance.</p>
<p>Thanks to the locality provided by PAW partial wave basis, it is possible to
perform response function calculations for correlated electron materials. The
LDA+U formalism is usable without any restriction for the PAW+DFPT
calculations.</p>
<p>All the tutorials dedicated to response functions can be followed both with
norm-conserving pseudopotentials and with PAW atomic datasets.</p>
<p>More detailed explanations to perform a response calculation are given in the
<a href="../../../users/generated_files/help_respfn.html">help_respfn </a>file.</p>
<h2 id="related-input-variables"><strong> Related Input Variables </strong><a class="headerlink" href="#related-input-variables" title="Permanent link">&para;</a></h2>
<p><em>basic:</em></p>
<ul>
<li><a class="wikilink" href="../../input_variables/dfpt/#rfatpol">rfatpol</a>  Response Function : ATomic POLarisation</li>
<li><a class="wikilink" href="../../input_variables/dfpt/#rfddk">rfddk</a>  Response Function with respect to Derivative with respect to K</li>
<li><a class="wikilink" href="../../input_variables/dfpt/#rfelfd">rfelfd</a>  Response Function with respect to the ELectric FielD</li>
<li><a class="wikilink" href="../../input_variables/dfpt/#rfmagn">rfmagn</a>  Response Function with respect to MAGNetic B-field perturbation</li>
<li><a class="wikilink" href="../../input_variables/dfpt/#rfphon">rfphon</a>  Response Function with respect to PHONons</li>
<li><a class="wikilink" href="../../input_variables/dfpt/#rfstrs">rfstrs</a>  Response Function with respect to STRainS</li>
</ul>
<p><em>compulsory:</em></p>
<ul>
<li><a class="wikilink" href="../../input_variables/gstate/#optdriver">optdriver</a>  OPTions for the DRIVER</li>
<li><a class="wikilink" href="../../input_variables/dfpt/#rfdir">rfdir</a>  Response Function : DIRections</li>
</ul>
<p><em>expert:</em></p>
<ul>
<li><a class="wikilink" href="../../input_variables/dfpt/#frzfermi">frzfermi</a>  FReeZe FERMI energy</li>
<li><a class="wikilink" href="../../input_variables/paw/#pawcross">pawcross</a>  PAW - add CROSS term in oscillator strengths</li>
<li><a class="wikilink" href="../../input_variables/dfpt/#rf2_dkdk">rf2_dkdk</a>  Response Function : 2nd Derivative of wavefunctions with respect to K</li>
<li><a class="wikilink" href="../../input_variables/dfpt/#rfmeth">rfmeth</a>  Response Function METHod</li>
<li><a class="wikilink" href="../../input_variables/dfpt/#rfuser">rfuser</a>  Response Function, USER-defined</li>
<li><a class="wikilink" href="../../input_variables/gstate/#scphon_supercell">scphon_supercell</a>  Self Consistent PHONon SUPERCELL</li>
<li><a class="wikilink" href="../../input_variables/gstate/#scphon_temp">scphon_temp</a>  Self Consistent PHONon TEMPerature</li>
</ul>
<p><em>internal:</em></p>
<ul>
<li><a class="wikilink" href="../../input_variables/internal/#qptn">qptn</a>  Q-PoinT re-Normalized</li>
</ul>
<p><em>useful:</em></p>
<ul>
<li><a class="wikilink" href="../../input_variables/eph/#asr">asr</a>  Acoustic Sum Rule</li>
<li><a class="wikilink" href="../../input_variables/dfpt/#dfpt_sciss">dfpt_sciss</a>  DFPT SCISSor operator</li>
<li><a class="wikilink" href="../../input_variables/dev/#getwfkfine">getwfkfine</a>  GET the fine grid wavefunctions from _WFK file</li>
<li><a class="wikilink" href="../../input_variables/files/#ird1wf">ird1wf</a>  Integer that governs the ReaDing of _1WF files </li>
<li><a class="wikilink" href="../../input_variables/files/#irdddk">irdddk</a>  Integer that governs the ReaDing of DDK wavefunctions, in _1WF files</li>
<li><a class="wikilink" href="../../input_variables/files/#irdwfq">irdwfq</a>  Integer that governs the ReaDing of _WFQ files</li>
</ul>
<h2 id="selected-input-files"><strong> Selected Input Files </strong><a class="headerlink" href="#selected-input-files" title="Permanent link">&para;</a></h2>
<p><em>v4:</em></p>
<ul>
<li><a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../tests/v4/Input/t63.in" title="Test of the strain perturbation. GaAs in a hypothetical wurzite (hexagonal) strucure,  using HGH potentials.  The main point here is to test the strain derivatives in a hexagonal symmetry situation.  The indexing of the strain components is pert=natom+3 for 3 uniaxial components,  and pert=natom+4 for 3 shear components,  translating in this case to (dir,  pert,  cartesian strain) triplets 1 7 xx          1 8 yz 2 7 yy          2 8 xz 3 7 zz          3 8 xy We see that the cartesian 2nd-order matrix has the expected symmetry despite the lack of any x&lt;-&gt;y symmetry operations in this space group. A curious user might wish to extend this test to all strain components (rfstrs2  3;  rfdir2 1 1 1) and observe an unexpected symmetry among the cartesian internal strain terms.  In particular, certain diagonal and shear terms are identical,  such as 1 1 1 7 (x,  xx) and 2 1 3 8 (y,  xy) where (., .) means (force,  strain).">tests/v4/Input/t63.in</a></li>
<li><a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../tests/v4/Input/t66.in" title="Test of the strain perturbation for the rigid-ion piezoelectric tensor.  Rhombohedrally distorted AlP as in the previous test,  but using a ground-state finite- difference calculation of the d/dk wave functions.  Such calculations were used extensively to test the response function piezoelectric tensor by comparison to numerical derivatives of the ground-state polarization.  Using the same k sample in the ground state and response function calculations,  excellent agreement has been obtained in a variety of cases (including a better-converged version of this one).  Results using the finite- diffrence d/dk and the analytic d/dk as in the preceeding test agree in the limit of large k sample. The analytic form converges much more rapidly,  and is consistent with the slowly converging polarization numerical derivatives. The present version of this calculation uses berryopt = -2 to utilize the routine berryphase_new.f The ground-state polarization calculations used to compute the numerical derivatives in such tests should also be computed using berryphase_new.f setting berryopt = -1 and rfdir = 1 1 1 so that the cartesian polarization is automatically generated. This eliminates several issues that needed special attention using berryopt = 1 and the original berryphase.f routine. The resulting cartesian polarization derivatives represent the &quot;improper&quot; piezoelectric tensor,  and have to be corrected to yield the &quot;proper&quot; tensor as described in D. Vanderbilt,  J. Phys. Chem. Solids 61,  147 (2000),  using Eq.(15).  The response-function calculation gives the proper piezoelectric tensor.  Only the electron response,  and not the strain-induced movement of the rigid ions contributes to the proper tensor.">tests/v4/Input/t66.in</a></li>
</ul>
<p><em>v5:</em></p>
<ul>
<li><a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../tests/v5/Input/t05.in" title="PAW response function calculation of derivative of wavefunction (DDK) Si with PAW dataset generated from uspp code. Computes derivative with DFPT formalism,  and also computes energies with displaced k+q so that energies can be checked by finite differences.">tests/v5/Input/t05.in</a></li>
<li><a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../tests/v5/Input/t30.in" title="Compute DDK response in PAW formalism for two different but equivalent input variables: rfddk 1,  rfelfd 2">tests/v5/Input/t30.in</a></li>
</ul>
<p><em>v6:</em></p>
<ul>
<li><a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../tests/v6/Input/t62.in" title="Computation of phonons and response to electric field within PAW (both q=0 and q/=0) Test on AlAs structure inspired by tutorespfn/trf2 tutorial. Ground state is computed. DDK is computed. Dielectric tensor is computed. Phonon modes at q=0 are computed. Phonons modes at q=(1/4, 0, 0) and q=(-1/4, 1/2/1/4) are computed. Note: Charge neutrality is not achieved with the present dataset, but can be easily reached by increasing some parameters;  for instance: (ngkpt 8 8 8,  ecut 15.,  pawecutdg 30.) gives Z(Al)=2.1184310,  Z(As)=-2.1184804">tests/v6/Input/t62.in</a></li>
<li><a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../tests/v6/Input/t63.in" title="Si diatomic molecule Test of linear and non-linear response in the non-spin-polarized case. Only four bands are allowed,  both spin-up and spin-down,  so that the molecule is non spin polarized. However nsppol=2 for testing purposes. Over 1200 WARNINGS. This test must give the same results of the test 64 non-linear response with nsppol=1 does not support MPI with nprocs &gt; 1">tests/v6/Input/t63.in</a></li>
<li><a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../tests/v6/Input/t89.in" title="Computation of phonons frequencies for metallic occupations at q=0 0 0 within PAW O2 (nsppol=1);  this test is directly inspired by test v3#75. In datasets 1-3,  one computes the total energy and forces,  without symmetries, as it should be for accurate finite-difference tests. From the reduced gradients with respect to displacements,  one can deduce a 2DTE of 149.9614 Ha. In dataset 4,  RF is computed with the Fermi energy correction, and the agreement with finite-differences of datasets 1 and 3 is good : one gets 149.9612 Ha. In dataset 5,  RF is computed with frozen Fermi energy and the disagreement with finite-differences of datasets 1 and 3 is large: one gets 124.9787 Ha.">tests/v6/Input/t89.in</a></li>
</ul>
<p><em>v7:</em></p>
<ul>
<li><a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../tests/v7/Input/t43.in" title="EuO rock salt structure. 20-electron PAW pseudo (4f in the core,  but 4d10 as semi-core : 4d10 5s2 5p6 (5d0) 6s2 ) Test of computation of dielectric tensor,  Born effective charges,  dynamical matrix. To keep the CPU time to a reasonable level,  the responses are computed with minimal parameters (nstep and the kpoint grid are too small, ecut might be increased,  and also pawecutdg). Note: Charge neutrality is not achieved with the present dataset for Born Effective Charges, but can be easily reached by increasing some parameters;  for instance: (ngkpt 6 6 6,   ecut 40. pawecutdg 40.) gives Z(Eu)=2.5085,  Z(O)=-2.4982">tests/v7/Input/t43.in</a></li>
<li><a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../tests/v7/Input/t45.in" title="This tests uses psps8 files with model core charges and valence charge densities. We test the initialization of rhor1,  rhog1 from atomic quantities and the treatment of the non-linear core correction in G-space (nc_xccc_gspace).">tests/v7/Input/t45.in</a></li>
</ul>
<p><em>v8:</em></p>
<ul>
<li><a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../tests/v8/Input/t07.in" title="Computation of elastic tensor and internal strain in DFPT+PAW Ground state is computed. DFPT is computed">tests/v8/Input/t07.in</a></li>
<li><a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../tests/v8/Input/t20.in" title="Response of magnetic metal to external magnetic field. First,  ground state wf is computed,  then dfpt calculation.">tests/v8/Input/t20.in</a></li>
</ul>

  <br>
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../DFT+U/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../DFT+U/" class="btn btn-xs btn-link">
        DFT+U
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Dev/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Dev/" class="btn btn-xs btn-link">
        Dev
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
<hr>

    <center>Abinit version 8.5.4</center>


<center>Copyright &copy; 2017 The Abinit Group (MT)</center>


<center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
</footer>

</body>
</html>