<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="The Abinit group">
    <link rel="canonical" href="http://www.abinit.org/topics/MagMom/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>MagMom - abinit</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../css/codehilite.css" rel="stylesheet">
    <link href="../../css/extra.css" rel="stylesheet">
    
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <!-- <script src="../../js/somelib.js"></script> -->

    <!-- Jquery from Google CDN 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    -->

    <!-- Bootstrap http://getbootstrap.com/getting-started/ -->
    <!-- Latest compiled and minified CSS 

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    -->
    <!-- Optional theme

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    -->
    <!-- Latest compiled and minified JavaScript

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    -->

    <!-- MathJax support -->
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script> 
    <!--
    <script type="text/javascript" async 
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_SVG">
    </script> 
    -->

    <!--
    Configure MathJax to produce automatic equation numbers
    http://docs.mathjax.org/en/latest/tex.html
    -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          TeX: {
              equationNumbers: { autoNumber: "all" },
              extensions: ["AMSmath.js"],
              Macros: {
                  rr: "{\\bf r}",
                  GG: "{\\bf G}",
                  kk: "{\\bf k}",
                  qq: "{\\bf q}"
              }
          }
      });
    </script>

    <!-- See http://docs.mathjax.org/en/latest/start.html 
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        extensions: ["tex2jax.js", "MathMenu.js", "MathZoom.js"],
        jax: ["input/TeX", "output/HTML-CSS", "output/NativeMML],
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true
        },
        "HTML-CSS": { availableFonts: ["TeX"] }
      });
    </script>
    -->


    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Introduction", url: "#introduction", children: [
          ]},
          {title: "Related Input Variables", url: "#related-input-variables", children: [
          ]},
          {title: "Selected Input Files", url: "#selected-input-files", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.8/ace.js"></script>
      <script src="../../extra_javascript/abidocs.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../MolecularDynamics/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../MolecularDynamics/" class="btn btn-xs btn-link">
        MolecularDynamics
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../MagField/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../MagField/" class="btn btn-xs btn-link">
        MagField
      </a>
    </div>
    
  </div>

    

    <h2 id="introduction"><strong> Introduction </strong><a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>A complementary magnetic constraint method has been implemented in the ABINIT
code, wherein the magnetization around each atom is pushed to a desired
(vectorial) value. The constraint can either be on the full vector quantity,
<script type="math/tex">\vec{m}</script>, or only on the direction <strong>m</strong>. This is mainly useful for non
collinear systems, where the direction and amplitude of the magnetic moment
can change. The method follows that used in the Quantum Espresso
<a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../bibliography/#Moscaconte2007" title="Quantum mechanical modeling of nano magnetism">Moscaconte2007</a> and VASP <a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../bibliography/#Ma2015" title="Constrained density functional for noncollinear magnetism">Ma2015</a> codes: a Lagrangian constraint is
applied to the energy, and works through a resulting term in the potential,
which acts on the different spin components. The magnetization in a sphere Ωi
around atom i at position <strong>R</strong>i is calculated as:</p>
<p><strong>m</strong> =∫Ωi <strong>m</strong>(<strong>r</strong>) d<strong>r</strong></p>
<p>and the corresponding potential for spin component α is written as:</p>
<p>Vα = 2 λ f(| <strong>r</strong>-<strong>R</strong>i| / rs) <strong>c</strong>α</p>
<p>The function f(x) = x2(3+x(1+x(-6+3x))), is applied to smooth the transition
near the edge of the sphere around <strong>R</strong>i, over a thickness rs (by default
0.05 bohr, and f is set to 0 for | <strong>r</strong>-<strong>R</strong>i|&gt; rs). This minimizes
discontinuous variations of the potential from iteration to iteration.</p>
<p>The constraint is managed by the keyword <a class="wikilink" href="../../input_variables/gstate/#magconon">magconon</a>. Value 1 gives a
constraint on the direction (<strong>c</strong> = <strong>m</strong> - <strong>s</strong>i (<strong>s</strong>i.<strong>m</strong>), value 2
gives a full constraint on the vector (<strong>c</strong> = <strong>m</strong> - <strong>s</strong>i), with respect
to the keyword <a class="wikilink" href="../../input_variables/gstate/#spinat">spinat</a> (<strong>s</strong>i above), giving a 3-vector for each atom. The
latter is quite a stringent constraint, and often may not converge. The former
value usually works, provided sufficient precision is given for the
calculation of the magnetic moment (kinetic energy cutoff in particular).</p>
<p>The strength of the constraint is given by the keyword <a class="wikilink" href="../../input_variables/gstate/#magcon_lambda">magcon_lambda</a> (λ
above - real valued). Typical values are 10-2 but vary strongly with system
type: this value should be started small (here the constraint may not be
enforced fully) and increased. A too large value leads to oscillations of the
magnetization (the equivalent of charge sloshing) which do not converge. A
corresponding Lagrange penalty term is added to the total energy, and is
printed to the log file, along with the effective magnetic field being
applied. In an ideal case the energy penalty term should go to 0 (the
constraint is fully satisfied).</p>
<h2 id="related-input-variables"><strong> Related Input Variables </strong><a class="headerlink" href="#related-input-variables" title="Permanent link">&para;</a></h2>
<p><em>useful:</em></p>
<ul>
<li><a class="wikilink" href="../../input_variables/gstate/#magcon_lambda">magcon_lambda</a>  MAGnetization CONstraint LAMBDA parameter</li>
<li><a class="wikilink" href="../../input_variables/gstate/#magconon">magconon</a>  turn MAGnetization CONstraint ON</li>
<li><a class="wikilink" href="../../input_variables/gstate/#ratsph">ratsph</a>  Radii of the ATomic SPHere(s)</li>
<li><a class="wikilink" href="../../input_variables/gstate/#spinat">spinat</a>  SPIN for AToms</li>
</ul>
<h2 id="selected-input-files"><strong> Selected Input Files </strong><a class="headerlink" href="#selected-input-files" title="Permanent link">&para;</a></h2>
<p><em>v7:</em></p>
<ul>
<li><a class="wikilink" data-placement="auto bottom" data-toggle="popover" data-trigger="hover" href="../../tests/v7/Input/t05.in" title="Test magnetic constraint code. Variables magconon and magcon_lambda. BCC iron with low cutoff and kpts,  non collinear spin case with nspden=4 imposed. First normal case then constrain direction only (DS2) and full value of vector (DS3)">tests/v7/Input/t05.in</a></li>
</ul>

  <br>
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../MolecularDynamics/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../MolecularDynamics/" class="btn btn-xs btn-link">
        MolecularDynamics
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../MagField/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../MagField/" class="btn btn-xs btn-link">
        MagField
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
<hr>

    <center>Abinit version 8.5.4</center>


<center>Copyright &copy; 2017 The Abinit Group (EB)</center>


<center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
</footer>

</body>
</html>